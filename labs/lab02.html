

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Lab 02: Georefereing Location-based Social Media &#8212; GEOGM0068: Geographic Information Retrieval and Integration</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'labs/lab02';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Lab 03: Indexing and Relevance Ranking on Geo-Texts" href="lab03.html" />
    <link rel="prev" title="Lab 01: Dealing with Spatial Data in Python" href="lab01.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/unit-logo2.png" class="logo__image only-light" alt="GEOGM0068: Geographic Information Retrieval and Integration - Home"/>
    <script>document.write(`<img src="../_static/unit-logo2.png" class="logo__image only-dark" alt="GEOGM0068: Geographic Information Retrieval and Integration - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Welcome to GEOGM0068: Geographic Information Retrieval and Integration
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Lecture</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../lectures/lecture01.html">Lecture 01: Introduction and Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lectures/lecture02.html">Lecture 02: Spatial Database I</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lectures/lecture03.html">Lecture 03: Spatial Database II</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lectures/lecture04.html">Lecture 04: Georeferencing I</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lectures/lecture05.html">Lecture 05: Georeferencing II</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lectures/lecture06.html">Lecture 06: Spatial Indexing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lectures/lecture07.html">Lecture 07: Spatial Ranking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lectures/lecture08.html">Lecture 08: Geospatial Semantics I</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lectures/lecture09.html">Lecture 09: Geospatial Semantics II</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lectures/lecture10.html">Lecture 10: Ethics, Summary, and Career</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Lab</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="lab01.html">Lab 01: Dealing with Spatial Data in Python</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Lab 02: Georefereing Location-based Social Media</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab03.html">Lab 03: Indexing and Relevance Ranking on Geo-Texts</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab04.html">Lab 04: Neural Network Embedding for Places</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/zhurui0509/GEOGM0068-git" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/zhurui0509/GEOGM0068-git/issues/new?title=Issue%20on%20page%20%2Flabs/lab02.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/labs/lab02.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Lab 02: Georefereing Location-based Social Media</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#part-1-1-retrieving-data-from-location-based-social-media">Part 1-1: Retrieving data from location-based social media</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#part-1-2-extracting-geo-text-from-twitter">Part 1-2: Extracting (geo)text from Twitter</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#part-2-basic-natural-language-processing-and-geoparsing">Part 2: Basic Natural Language Processing and Geoparsing</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#part-3-geocoding-the-recognized-place-names">Part 3: Geocoding the recognized place names</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="lab-02-georefereing-location-based-social-media">
<h1>Lab 02: Georefereing Location-based Social Media<a class="headerlink" href="#lab-02-georefereing-location-based-social-media" title="Permalink to this heading">#</a></h1>
<p>In this tutorial, we will learn:</p>
<ul class="simple">
<li><p>How to extract information (e.g., tweets) from location-based social media (e.g., Twitter)</p></li>
<li><p>How to identify locational information (e.g., place name) from text-based data (e.g., tweets, newspapers)</p></li>
<li><p>How to refer the identified location to metric-based coordinates on the surface of the earcth</p></li>
</ul>
<p>Several libraries/packages are needed in this tutorial. Use <code class="docutils literal notranslate"><span class="pre">pip</span></code> or <code class="docutils literal notranslate"><span class="pre">conda</span></code> to install them:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://pypi.org/project/tweepy/">tweepy</a>: this is library to access the Tweeter API</p></li>
<li><p><a class="reference external" href="https://spacy.io/usage">spaCy</a>: this is the library to do natural lanuguage processing</p></li>
<li><p><a class="reference external" href="https://pypi.org/project/spacy-dbpedia-spotlight/">spacy-dbpedia-spotlight</a>: a small library that annotate recognized entities from spaCy to DBpedia enities.</p></li>
</ul>
<section id="part-1-1-retrieving-data-from-location-based-social-media">
<h2>Part 1-1: Retrieving data from location-based social media<a class="headerlink" href="#part-1-1-retrieving-data-from-location-based-social-media" title="Permalink to this heading">#</a></h2>
<p>We can retrieve information from many location-based social media, such as Foursqure, Tweeter, Google Places, Yelp, and so. The key technique of doing so is through API (Application Programming Interface), which helps to bridge your program with the database these services develop. In this practice, we learn to access data from two social media – <a class="reference external" href="https://location.foursquare.com/docs/">Foursquare</a> and <a class="reference external" href="https://developer.twitter.com/en/docs/twitter-api">Twitter (X)</a>. Note that since X changed their API policy in 2023 charging for accessing their data, this practice only provides you the code. You are also not required to run through it by paying yourself. The code is provided for your future reference in case you want to use it in your career.</p>
<p>To use API in python, we need to install the <a class="reference external" href="https://pypi.org/project/requests/"><code class="docutils literal notranslate"><span class="pre">requests</span></code></a> library. The common way of using it is shown below. First, you need to define the endpoint url where the data is served at (usually you can find this information from the API’s documentation, e.g., <a class="reference external" href="https://location.foursquare.com/developer/reference/place-search">Foursquare Place</a>). Then you need to set up the parameters using the variable <code class="docutils literal notranslate"><span class="pre">params</span></code> for your query (again, you can find potential parameter variables in the documentation). Finally, you need to setup the <code class="docutils literal notranslate"><span class="pre">headers</span></code> of your request, which defines the data format of the response <code class="docutils literal notranslate"><span class="pre">Accept</span></code>, and your API <code class="docutils literal notranslate"><span class="pre">Authorization</span></code>. Where to get the authorization? Different APIs have different ways, for Foursquare, please check this <a class="reference external" href="https://location.foursquare.com/developer/reference/places-api-get-started">documentation</a>.</p>
<p>No matter which API you use, the logic/processes are mostly the same, as shown below. But details on how to set up the parameters, the url, and authorization process can be quite different. Lucily, most of these APIs provide detailed documentations with examples.</p>
<p>Now, please read the <a class="reference external" href="https://location.foursquare.com/developer/reference/foursquare-apis-overview">Foursqure Place</a> documentation, follow the instruction to create an account/authorization, and then replicate the following steps.</p>
<p>The following code basically query coffees that are within 500 meters of School of Geographic Science building, and rank them in the order of distance.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span> <span class="c1"># library to handle requests</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span> <span class="c1"># library for data analsysis</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span> <span class="c1"># library to handle data in a vectorized manner</span>
<span class="kn">import</span> <span class="nn">random</span> <span class="c1"># library for random number generation</span>


<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://api.foursquare.com/v3/places/search&quot;</span>

<span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="s2">&quot;coffee&quot;</span><span class="p">,</span>
  <span class="s2">&quot;ll&quot;</span><span class="p">:</span> <span class="s2">&quot;51.45712270688956,-2.605159893254094&quot;</span><span class="p">,</span>
  <span class="s2">&quot;radius&quot;</span><span class="p">:</span> <span class="s2">&quot;500&quot;</span><span class="p">,</span>  
  <span class="s2">&quot;sort&quot;</span><span class="p">:</span><span class="s2">&quot;DISTANCE&quot;</span>
<span class="p">}</span>

<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Accept&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="s2">&quot;fsq3o8iIO/yZccIR5QzSI1Jmz0RX3vJ2HXCkuJVDwk9o6rQ=&quot;</span> <span class="c1"># please change it to your own Authorization</span>
<span class="p">}</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/var/folders/xg/5n3zc4sn5hlcg8zzz6ysx21m0000gq/T/ipykernel_53963/3946376676.py:2: DeprecationWarning: 
Pyarrow will become a required dependency of pandas in the next major release of pandas (pandas 3.0),
(to allow more performant data types, such as the Arrow string type, and better interoperability with other libraries)
but was not found to be installed on your system.
If this would cause problems for you,
please provide us feedback at https://github.com/pandas-dev/pandas/issues/54466
        
  import pandas as pd # library for data analsysis
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&quot;results&quot;:[{&quot;fsq_id&quot;:&quot;4b058836f964a520ceb822e3&quot;,&quot;categories&quot;:[{&quot;id&quot;:13034,&quot;name&quot;:&quot;Café&quot;,&quot;short_name&quot;:&quot;Café&quot;,&quot;plural_name&quot;:&quot;Cafés&quot;,&quot;icon&quot;:{&quot;prefix&quot;:&quot;https://ss3.4sqi.net/img/categories_v2/food/cafe_&quot;,&quot;suffix&quot;:&quot;.png&quot;}},{&quot;id&quot;:13035,&quot;name&quot;:&quot;Coffee Shop&quot;,&quot;short_name&quot;:&quot;Coffee Shop&quot;,&quot;plural_name&quot;:&quot;Coffee Shops&quot;,&quot;icon&quot;:{&quot;prefix&quot;:&quot;https://ss3.4sqi.net/img/categories_v2/food/coffeeshop_&quot;,&quot;suffix&quot;:&quot;.png&quot;}},{&quot;id&quot;:13065,&quot;name&quot;:&quot;Restaurant&quot;,&quot;short_name&quot;:&quot;Restaurant&quot;,&quot;plural_name&quot;:&quot;Restaurants&quot;,&quot;icon&quot;:{&quot;prefix&quot;:&quot;https://ss3.4sqi.net/img/categories_v2/food/default_&quot;,&quot;suffix&quot;:&quot;.png&quot;}}],&quot;chains&quot;:[],&quot;closed_bucket&quot;:&quot;VeryLikelyOpen&quot;,&quot;distance&quot;:231,&quot;geocodes&quot;:{&quot;main&quot;:{&quot;latitude&quot;:51.455219,&quot;longitude&quot;:-2.603972},&quot;roof&quot;:{&quot;latitude&quot;:51.455219,&quot;longitude&quot;:-2.603972}},&quot;link&quot;:&quot;/v3/places/4b058836f964a520ceb822e3&quot;,&quot;location&quot;:{&quot;address&quot;:&quot;75 Park St&quot;,&quot;admin_region&quot;:&quot;England&quot;,&quot;country&quot;:&quot;GB&quot;,&quot;formatted_address&quot;:&quot;75 Park St, Bristol, BS1 5PF&quot;,&quot;locality&quot;:&quot;Bristol&quot;,&quot;post_town&quot;:&quot;Bristol&quot;,&quot;postcode&quot;:&quot;BS1 5PF&quot;,&quot;region&quot;:&quot;Bristol&quot;},&quot;name&quot;:&quot;Boston Tea Party&quot;,&quot;related_places&quot;:{},&quot;timezone&quot;:&quot;Europe/London&quot;},{&quot;fsq_id&quot;:&quot;557d9e15498e3fc4dda1ec92&quot;,&quot;categories&quot;:[{&quot;id&quot;:13002,&quot;name&quot;:&quot;Bakery&quot;,&quot;short_name&quot;:&quot;Bakery&quot;,&quot;plural_name&quot;:&quot;Bakeries&quot;,&quot;icon&quot;:{&quot;prefix&quot;:&quot;https://ss3.4sqi.net/img/categories_v2/food/bakery_&quot;,&quot;suffix&quot;:&quot;.png&quot;}},{&quot;id&quot;:13034,&quot;name&quot;:&quot;Café&quot;,&quot;short_name&quot;:&quot;Café&quot;,&quot;plural_name&quot;:&quot;Cafés&quot;,&quot;icon&quot;:{&quot;prefix&quot;:&quot;https://ss3.4sqi.net/img/categories_v2/food/cafe_&quot;,&quot;suffix&quot;:&quot;.png&quot;}},{&quot;id&quot;:13065,&quot;name&quot;:&quot;Restaurant&quot;,&quot;short_name&quot;:&quot;Restaurant&quot;,&quot;plural_name&quot;:&quot;Restaurants&quot;,&quot;icon&quot;:{&quot;prefix&quot;:&quot;https://ss3.4sqi.net/img/categories_v2/food/default_&quot;,&quot;suffix&quot;:&quot;.png&quot;}}],&quot;chains&quot;:[],&quot;closed_bucket&quot;:&quot;VeryLikelyOpen&quot;,&quot;distance&quot;:350,&quot;geocodes&quot;:{&quot;drop_off&quot;:{&quot;latitude&quot;:51.455446,&quot;longitude&quot;:-2.600694},&quot;main&quot;:{&quot;latitude&quot;:51.45533,&quot;longitude&quot;:-2.600682},&quot;roof&quot;:{&quot;latitude&quot;:51.45533,&quot;longitude&quot;:-2.600682}},&quot;link&quot;:&quot;/v3/places/557d9e15498e3fc4dda1ec92&quot;,&quot;location&quot;:{&quot;address&quot;:&quot;16 Park Row&quot;,&quot;admin_region&quot;:&quot;England&quot;,&quot;country&quot;:&quot;GB&quot;,&quot;cross_street&quot;:&quot;&quot;,&quot;formatted_address&quot;:&quot;16 Park Row, Bristol, BS1 5LJ&quot;,&quot;locality&quot;:&quot;Bristol&quot;,&quot;post_town&quot;:&quot;Bristol&quot;,&quot;postcode&quot;:&quot;BS1 5LJ&quot;,&quot;region&quot;:&quot;Bristol&quot;},&quot;name&quot;:&quot;Sotiris Bakery&quot;,&quot;related_places&quot;:{},&quot;timezone&quot;:&quot;Europe/London&quot;},{&quot;fsq_id&quot;:&quot;517e90a0e4b0f7d859cc9578&quot;,&quot;categories&quot;:[{&quot;id&quot;:13036,&quot;name&quot;:&quot;Tea Room&quot;,&quot;short_name&quot;:&quot;Tea Room&quot;,&quot;plural_name&quot;:&quot;Tea Rooms&quot;,&quot;icon&quot;:{&quot;prefix&quot;:&quot;https://ss3.4sqi.net/img/categories_v2/food/tearoom_&quot;,&quot;suffix&quot;:&quot;.png&quot;}}],&quot;chains&quot;:[],&quot;closed_bucket&quot;:&quot;VeryLikelyOpen&quot;,&quot;distance&quot;:360,&quot;geocodes&quot;:{&quot;main&quot;:{&quot;latitude&quot;:51.456274,&quot;longitude&quot;:-2.610294},&quot;roof&quot;:{&quot;latitude&quot;:51.456274,&quot;longitude&quot;:-2.610294}},&quot;link&quot;:&quot;/v3/places/517e90a0e4b0f7d859cc9578&quot;,&quot;location&quot;:{&quot;country&quot;:&quot;GB&quot;,&quot;cross_street&quot;:&quot;&quot;,&quot;formatted_address&quot;:&quot;&quot;},&quot;name&quot;:&quot;Ross&#39; Tea Corner&quot;,&quot;related_places&quot;:{},&quot;timezone&quot;:&quot;Europe/London&quot;},{&quot;fsq_id&quot;:&quot;4b6447c0f964a5200ca82ae3&quot;,&quot;categories&quot;:[{&quot;id&quot;:12010,&quot;name&quot;:&quot;Adult Education&quot;,&quot;short_name&quot;:&quot;Adult Education&quot;,&quot;plural_name&quot;:&quot;Adult Education&quot;,&quot;icon&quot;:{&quot;prefix&quot;:&quot;https://ss3.4sqi.net/img/categories_v2/building/school_&quot;,&quot;suffix&quot;:&quot;.png&quot;}}],&quot;chains&quot;:[],&quot;closed_bucket&quot;:&quot;VeryLikelyOpen&quot;,&quot;distance&quot;:406,&quot;geocodes&quot;:{&quot;main&quot;:{&quot;latitude&quot;:51.45419,&quot;longitude&quot;:-2.602153},&quot;roof&quot;:{&quot;latitude&quot;:51.45419,&quot;longitude&quot;:-2.602153}},&quot;link&quot;:&quot;/v3/places/4b6447c0f964a5200ca82ae3&quot;,&quot;location&quot;:{&quot;address&quot;:&quot;40a Park St&quot;,&quot;admin_region&quot;:&quot;England&quot;,&quot;country&quot;:&quot;GB&quot;,&quot;cross_street&quot;:&quot;&quot;,&quot;formatted_address&quot;:&quot;40a Park St, Bristol, BS1 5JG&quot;,&quot;locality&quot;:&quot;Bristol&quot;,&quot;post_town&quot;:&quot;Bristol&quot;,&quot;postcode&quot;:&quot;BS1 5JG&quot;,&quot;region&quot;:&quot;Bristol&quot;},&quot;name&quot;:&quot;Bristol Folk House&quot;,&quot;related_places&quot;:{},&quot;timezone&quot;:&quot;Europe/London&quot;},{&quot;fsq_id&quot;:&quot;5e6235421381060008b18679&quot;,&quot;categories&quot;:[{&quot;id&quot;:13034,&quot;name&quot;:&quot;Café&quot;,&quot;short_name&quot;:&quot;Café&quot;,&quot;plural_name&quot;:&quot;Cafés&quot;,&quot;icon&quot;:{&quot;prefix&quot;:&quot;https://ss3.4sqi.net/img/categories_v2/food/cafe_&quot;,&quot;suffix&quot;:&quot;.png&quot;}},{&quot;id&quot;:13035,&quot;name&quot;:&quot;Coffee Shop&quot;,&quot;short_name&quot;:&quot;Coffee Shop&quot;,&quot;plural_name&quot;:&quot;Coffee Shops&quot;,&quot;icon&quot;:{&quot;prefix&quot;:&quot;https://ss3.4sqi.net/img/categories_v2/food/coffeeshop_&quot;,&quot;suffix&quot;:&quot;.png&quot;}},{&quot;id&quot;:13065,&quot;name&quot;:&quot;Restaurant&quot;,&quot;short_name&quot;:&quot;Restaurant&quot;,&quot;plural_name&quot;:&quot;Restaurants&quot;,&quot;icon&quot;:{&quot;prefix&quot;:&quot;https://ss3.4sqi.net/img/categories_v2/food/default_&quot;,&quot;suffix&quot;:&quot;.png&quot;}}],&quot;chains&quot;:[],&quot;closed_bucket&quot;:&quot;Unsure&quot;,&quot;distance&quot;:428,&quot;geocodes&quot;:{&quot;drop_off&quot;:{&quot;latitude&quot;:51.459369,&quot;longitude&quot;:-2.609964},&quot;main&quot;:{&quot;latitude&quot;:51.459152,&quot;longitude&quot;:-2.609873},&quot;roof&quot;:{&quot;latitude&quot;:51.459152,&quot;longitude&quot;:-2.609873}},&quot;link&quot;:&quot;/v3/places/5e6235421381060008b18679&quot;,&quot;location&quot;:{&quot;address&quot;:&quot;St Pauls Rd&quot;,&quot;admin_region&quot;:&quot;England&quot;,&quot;country&quot;:&quot;GB&quot;,&quot;cross_street&quot;:&quot;&quot;,&quot;formatted_address&quot;:&quot;St Pauls Rd, Bristol, BS8 1LX&quot;,&quot;locality&quot;:&quot;Bristol&quot;,&quot;post_town&quot;:&quot;Bristol&quot;,&quot;postcode&quot;:&quot;BS8 1LX&quot;,&quot;region&quot;:&quot;Bristol&quot;},&quot;name&quot;:&quot;Caffe Clifton&quot;,&quot;related_places&quot;:{&quot;parent&quot;:{&quot;fsq_id&quot;:&quot;4b058834f964a5204bb822e3&quot;,&quot;categories&quot;:[{&quot;id&quot;:19014,&quot;name&quot;:&quot;Hotel&quot;,&quot;short_name&quot;:&quot;Hotel&quot;,&quot;plural_name&quot;:&quot;Hotels&quot;,&quot;icon&quot;:{&quot;prefix&quot;:&quot;https://ss3.4sqi.net/img/categories_v2/travel/hotel_&quot;,&quot;suffix&quot;:&quot;.png&quot;}}],&quot;name&quot;:&quot;The Clifton Hotel&quot;}},&quot;timezone&quot;:&quot;Europe/London&quot;},{&quot;fsq_id&quot;:&quot;4ce3baeea3c6721ed2df11cf&quot;,&quot;categories&quot;:[{&quot;id&quot;:13034,&quot;name&quot;:&quot;Café&quot;,&quot;short_name&quot;:&quot;Café&quot;,&quot;plural_name&quot;:&quot;Cafés&quot;,&quot;icon&quot;:{&quot;prefix&quot;:&quot;https://ss3.4sqi.net/img/categories_v2/food/cafe_&quot;,&quot;suffix&quot;:&quot;.png&quot;}},{&quot;id&quot;:13065,&quot;name&quot;:&quot;Restaurant&quot;,&quot;short_name&quot;:&quot;Restaurant&quot;,&quot;plural_name&quot;:&quot;Restaurants&quot;,&quot;icon&quot;:{&quot;prefix&quot;:&quot;https://ss3.4sqi.net/img/categories_v2/food/default_&quot;,&quot;suffix&quot;:&quot;.png&quot;}}],&quot;chains&quot;:[],&quot;closed_bucket&quot;:&quot;VeryLikelyOpen&quot;,&quot;distance&quot;:440,&quot;geocodes&quot;:{&quot;drop_off&quot;:{&quot;latitude&quot;:51.458888,&quot;longitude&quot;:-2.611066},&quot;main&quot;:{&quot;latitude&quot;:51.458696,&quot;longitude&quot;:-2.61096},&quot;roof&quot;:{&quot;latitude&quot;:51.458696,&quot;longitude&quot;:-2.61096}},&quot;link&quot;:&quot;/v3/places/4ce3baeea3c6721ed2df11cf&quot;,&quot;location&quot;:{&quot;address&quot;:&quot;St Paul&#39;s Rd&quot;,&quot;country&quot;:&quot;GB&quot;,&quot;cross_street&quot;:&quot;&quot;,&quot;formatted_address&quot;:&quot;St Paul&#39;s Rd, Bristol&quot;,&quot;locality&quot;:&quot;Bristol&quot;,&quot;post_town&quot;:&quot;Bristol&quot;,&quot;region&quot;:&quot;Bristol&quot;},&quot;name&quot;:&quot;Caffe Clifton&quot;,&quot;related_places&quot;:{},&quot;timezone&quot;:&quot;Europe/London&quot;},{&quot;fsq_id&quot;:&quot;59bd2120da5ede2141070f99&quot;,&quot;categories&quot;:[{&quot;id&quot;:13034,&quot;name&quot;:&quot;Café&quot;,&quot;short_name&quot;:&quot;Café&quot;,&quot;plural_name&quot;:&quot;Cafés&quot;,&quot;icon&quot;:{&quot;prefix&quot;:&quot;https://ss3.4sqi.net/img/categories_v2/food/cafe_&quot;,&quot;suffix&quot;:&quot;.png&quot;}},{&quot;id&quot;:13040,&quot;name&quot;:&quot;Dessert Shop&quot;,&quot;short_name&quot;:&quot;Desserts&quot;,&quot;plural_name&quot;:&quot;Dessert Shops&quot;,&quot;icon&quot;:{&quot;prefix&quot;:&quot;https://ss3.4sqi.net/img/categories_v2/food/dessert_&quot;,&quot;suffix&quot;:&quot;.png&quot;}},{&quot;id&quot;:13065,&quot;name&quot;:&quot;Restaurant&quot;,&quot;short_name&quot;:&quot;Restaurant&quot;,&quot;plural_name&quot;:&quot;Restaurants&quot;,&quot;icon&quot;:{&quot;prefix&quot;:&quot;https://ss3.4sqi.net/img/categories_v2/food/default_&quot;,&quot;suffix&quot;:&quot;.png&quot;}}],&quot;chains&quot;:[],&quot;closed_bucket&quot;:&quot;VeryLikelyOpen&quot;,&quot;distance&quot;:458,&quot;geocodes&quot;:{&quot;main&quot;:{&quot;latitude&quot;:51.453793,&quot;longitude&quot;:-2.601547},&quot;roof&quot;:{&quot;latitude&quot;:51.453793,&quot;longitude&quot;:-2.601547}},&quot;link&quot;:&quot;/v3/places/59bd2120da5ede2141070f99&quot;,&quot;location&quot;:{&quot;address&quot;:&quot;20 Park St&quot;,&quot;admin_region&quot;:&quot;England&quot;,&quot;country&quot;:&quot;GB&quot;,&quot;cross_street&quot;:&quot;&quot;,&quot;formatted_address&quot;:&quot;20 Park St, Bristol, BS1 5JA&quot;,&quot;locality&quot;:&quot;Bristol&quot;,&quot;post_town&quot;:&quot;Bristol&quot;,&quot;postcode&quot;:&quot;BS1 5JA&quot;,&quot;region&quot;:&quot;Bristol&quot;},&quot;name&quot;:&quot;Mrs. Potts Chocolate House&quot;,&quot;related_places&quot;:{},&quot;timezone&quot;:&quot;Europe/London&quot;},{&quot;fsq_id&quot;:&quot;4c3469ed3ffc952179da90f5&quot;,&quot;categories&quot;:[{&quot;id&quot;:13034,&quot;name&quot;:&quot;Café&quot;,&quot;short_name&quot;:&quot;Café&quot;,&quot;plural_name&quot;:&quot;Cafés&quot;,&quot;icon&quot;:{&quot;prefix&quot;:&quot;https://ss3.4sqi.net/img/categories_v2/food/cafe_&quot;,&quot;suffix&quot;:&quot;.png&quot;}},{&quot;id&quot;:13035,&quot;name&quot;:&quot;Coffee Shop&quot;,&quot;short_name&quot;:&quot;Coffee Shop&quot;,&quot;plural_name&quot;:&quot;Coffee Shops&quot;,&quot;icon&quot;:{&quot;prefix&quot;:&quot;https://ss3.4sqi.net/img/categories_v2/food/coffeeshop_&quot;,&quot;suffix&quot;:&quot;.png&quot;}},{&quot;id&quot;:13065,&quot;name&quot;:&quot;Restaurant&quot;,&quot;short_name&quot;:&quot;Restaurant&quot;,&quot;plural_name&quot;:&quot;Restaurants&quot;,&quot;icon&quot;:{&quot;prefix&quot;:&quot;https://ss3.4sqi.net/img/categories_v2/food/default_&quot;,&quot;suffix&quot;:&quot;.png&quot;}}],&quot;chains&quot;:[],&quot;closed_bucket&quot;:&quot;VeryLikelyOpen&quot;,&quot;distance&quot;:462,&quot;geocodes&quot;:{&quot;main&quot;:{&quot;latitude&quot;:51.460572,&quot;longitude&quot;:-2.60179},&quot;roof&quot;:{&quot;latitude&quot;:51.460572,&quot;longitude&quot;:-2.60179}},&quot;link&quot;:&quot;/v3/places/4c3469ed3ffc952179da90f5&quot;,&quot;location&quot;:{&quot;address&quot;:&quot;135 St. Michaels Hill&quot;,&quot;admin_region&quot;:&quot;England&quot;,&quot;country&quot;:&quot;GB&quot;,&quot;cross_street&quot;:&quot;at Highbury Villas&quot;,&quot;formatted_address&quot;:&quot;135 St. Michaels Hill (at Highbury Villas), Bristol, BS2 8BS&quot;,&quot;locality&quot;:&quot;Bristol&quot;,&quot;post_town&quot;:&quot;Bristol&quot;,&quot;postcode&quot;:&quot;BS2 8BS&quot;},&quot;name&quot;:&quot;Twoday Coffee Roasters&quot;,&quot;related_places&quot;:{},&quot;timezone&quot;:&quot;Europe/London&quot;},{&quot;fsq_id&quot;:&quot;4b058837f964a520deb822e3&quot;,&quot;categories&quot;:[{&quot;id&quot;:13034,&quot;name&quot;:&quot;Café&quot;,&quot;short_name&quot;:&quot;Café&quot;,&quot;plural_name&quot;:&quot;Cafés&quot;,&quot;icon&quot;:{&quot;prefix&quot;:&quot;https://ss3.4sqi.net/img/categories_v2/food/cafe_&quot;,&quot;suffix&quot;:&quot;.png&quot;}},{&quot;id&quot;:13035,&quot;name&quot;:&quot;Coffee Shop&quot;,&quot;short_name&quot;:&quot;Coffee Shop&quot;,&quot;plural_name&quot;:&quot;Coffee Shops&quot;,&quot;icon&quot;:{&quot;prefix&quot;:&quot;https://ss3.4sqi.net/img/categories_v2/food/coffeeshop_&quot;,&quot;suffix&quot;:&quot;.png&quot;}},{&quot;id&quot;:13065,&quot;name&quot;:&quot;Restaurant&quot;,&quot;short_name&quot;:&quot;Restaurant&quot;,&quot;plural_name&quot;:&quot;Restaurants&quot;,&quot;icon&quot;:{&quot;prefix&quot;:&quot;https://ss3.4sqi.net/img/categories_v2/food/default_&quot;,&quot;suffix&quot;:&quot;.png&quot;}}],&quot;chains&quot;:[],&quot;closed_bucket&quot;:&quot;VeryLikelyOpen&quot;,&quot;distance&quot;:464,&quot;geocodes&quot;:{&quot;main&quot;:{&quot;latitude&quot;:51.453685,&quot;longitude&quot;:-2.601516},&quot;roof&quot;:{&quot;latitude&quot;:51.453685,&quot;longitude&quot;:-2.601516}},&quot;link&quot;:&quot;/v3/places/4b058837f964a520deb822e3&quot;,&quot;location&quot;:{&quot;address&quot;:&quot;18 Park St&quot;,&quot;admin_region&quot;:&quot;England&quot;,&quot;country&quot;:&quot;GB&quot;,&quot;cross_street&quot;:&quot;&quot;,&quot;formatted_address&quot;:&quot;18 Park St, Bristol, BS1 5JA&quot;,&quot;locality&quot;:&quot;Bristol&quot;,&quot;post_town&quot;:&quot;Bristol&quot;,&quot;postcode&quot;:&quot;BS1 5JA&quot;,&quot;region&quot;:&quot;Bristol&quot;},&quot;name&quot;:&quot;Woodes&quot;,&quot;related_places&quot;:{},&quot;timezone&quot;:&quot;Europe/London&quot;},{&quot;fsq_id&quot;:&quot;59ac098a86bc494d39e6effc&quot;,&quot;categories&quot;:[{&quot;id&quot;:13034,&quot;name&quot;:&quot;Café&quot;,&quot;short_name&quot;:&quot;Café&quot;,&quot;plural_name&quot;:&quot;Cafés&quot;,&quot;icon&quot;:{&quot;prefix&quot;:&quot;https://ss3.4sqi.net/img/categories_v2/food/cafe_&quot;,&quot;suffix&quot;:&quot;.png&quot;}},{&quot;id&quot;:13003,&quot;name&quot;:&quot;Bar&quot;,&quot;short_name&quot;:&quot;Bar&quot;,&quot;plural_name&quot;:&quot;Bars&quot;,&quot;icon&quot;:{&quot;prefix&quot;:&quot;https://ss3.4sqi.net/img/categories_v2/nightlife/pub_&quot;,&quot;suffix&quot;:&quot;.png&quot;}}],&quot;chains&quot;:[],&quot;closed_bucket&quot;:&quot;LikelyOpen&quot;,&quot;distance&quot;:469,&quot;geocodes&quot;:{&quot;main&quot;:{&quot;latitude&quot;:51.457739,&quot;longitude&quot;:-2.612143},&quot;roof&quot;:{&quot;latitude&quot;:51.457739,&quot;longitude&quot;:-2.612143}},&quot;link&quot;:&quot;/v3/places/59ac098a86bc494d39e6effc&quot;,&quot;location&quot;:{&quot;address&quot;:&quot;99 Queens Rd&quot;,&quot;admin_region&quot;:&quot;England&quot;,&quot;country&quot;:&quot;GB&quot;,&quot;cross_street&quot;:&quot;&quot;,&quot;formatted_address&quot;:&quot;99 Queens Rd, Bristol, BS8 1LW&quot;,&quot;locality&quot;:&quot;Bristol&quot;,&quot;post_town&quot;:&quot;Bristol&quot;,&quot;postcode&quot;:&quot;BS8 1LW&quot;,&quot;region&quot;:&quot;Bristol&quot;},&quot;name&quot;:&quot;99 Queens&quot;,&quot;related_places&quot;:{},&quot;timezone&quot;:&quot;Europe/London&quot;}],&quot;context&quot;:{&quot;geo_bounds&quot;:{&quot;circle&quot;:{&quot;center&quot;:{&quot;latitude&quot;:51.45712270688956,&quot;longitude&quot;:-2.605159893254094},&quot;radius&quot;:500}}}}
</pre></div>
</div>
</div>
</div>
<p>As can be seen, the <code class="docutils literal notranslate"><span class="pre">response</span></code> is a messy chunk of text that is hard to interpret. We can then organize it using <code class="docutils literal notranslate"><span class="pre">json</span></code>’s structure.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="n">json_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
<span class="n">json_data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;results&#39;: [{&#39;fsq_id&#39;: &#39;4b058836f964a520ceb822e3&#39;,
   &#39;categories&#39;: [{&#39;id&#39;: 13034,
     &#39;name&#39;: &#39;Café&#39;,
     &#39;short_name&#39;: &#39;Café&#39;,
     &#39;plural_name&#39;: &#39;Cafés&#39;,
     &#39;icon&#39;: {&#39;prefix&#39;: &#39;https://ss3.4sqi.net/img/categories_v2/food/cafe_&#39;,
      &#39;suffix&#39;: &#39;.png&#39;}},
    {&#39;id&#39;: 13035,
     &#39;name&#39;: &#39;Coffee Shop&#39;,
     &#39;short_name&#39;: &#39;Coffee Shop&#39;,
     &#39;plural_name&#39;: &#39;Coffee Shops&#39;,
     &#39;icon&#39;: {&#39;prefix&#39;: &#39;https://ss3.4sqi.net/img/categories_v2/food/coffeeshop_&#39;,
      &#39;suffix&#39;: &#39;.png&#39;}},
    {&#39;id&#39;: 13065,
     &#39;name&#39;: &#39;Restaurant&#39;,
     &#39;short_name&#39;: &#39;Restaurant&#39;,
     &#39;plural_name&#39;: &#39;Restaurants&#39;,
     &#39;icon&#39;: {&#39;prefix&#39;: &#39;https://ss3.4sqi.net/img/categories_v2/food/default_&#39;,
      &#39;suffix&#39;: &#39;.png&#39;}}],
   &#39;chains&#39;: [],
   &#39;closed_bucket&#39;: &#39;VeryLikelyOpen&#39;,
   &#39;distance&#39;: 231,
   &#39;geocodes&#39;: {&#39;main&#39;: {&#39;latitude&#39;: 51.455219, &#39;longitude&#39;: -2.603972},
    &#39;roof&#39;: {&#39;latitude&#39;: 51.455219, &#39;longitude&#39;: -2.603972}},
   &#39;link&#39;: &#39;/v3/places/4b058836f964a520ceb822e3&#39;,
   &#39;location&#39;: {&#39;address&#39;: &#39;75 Park St&#39;,
    &#39;admin_region&#39;: &#39;England&#39;,
    &#39;country&#39;: &#39;GB&#39;,
    &#39;formatted_address&#39;: &#39;75 Park St, Bristol, BS1 5PF&#39;,
    &#39;locality&#39;: &#39;Bristol&#39;,
    &#39;post_town&#39;: &#39;Bristol&#39;,
    &#39;postcode&#39;: &#39;BS1 5PF&#39;,
    &#39;region&#39;: &#39;Bristol&#39;},
   &#39;name&#39;: &#39;Boston Tea Party&#39;,
   &#39;related_places&#39;: {},
   &#39;timezone&#39;: &#39;Europe/London&#39;},
  {&#39;fsq_id&#39;: &#39;557d9e15498e3fc4dda1ec92&#39;,
   &#39;categories&#39;: [{&#39;id&#39;: 13002,
     &#39;name&#39;: &#39;Bakery&#39;,
     &#39;short_name&#39;: &#39;Bakery&#39;,
     &#39;plural_name&#39;: &#39;Bakeries&#39;,
     &#39;icon&#39;: {&#39;prefix&#39;: &#39;https://ss3.4sqi.net/img/categories_v2/food/bakery_&#39;,
      &#39;suffix&#39;: &#39;.png&#39;}},
    {&#39;id&#39;: 13034,
     &#39;name&#39;: &#39;Café&#39;,
     &#39;short_name&#39;: &#39;Café&#39;,
     &#39;plural_name&#39;: &#39;Cafés&#39;,
     &#39;icon&#39;: {&#39;prefix&#39;: &#39;https://ss3.4sqi.net/img/categories_v2/food/cafe_&#39;,
      &#39;suffix&#39;: &#39;.png&#39;}},
    {&#39;id&#39;: 13065,
     &#39;name&#39;: &#39;Restaurant&#39;,
     &#39;short_name&#39;: &#39;Restaurant&#39;,
     &#39;plural_name&#39;: &#39;Restaurants&#39;,
     &#39;icon&#39;: {&#39;prefix&#39;: &#39;https://ss3.4sqi.net/img/categories_v2/food/default_&#39;,
      &#39;suffix&#39;: &#39;.png&#39;}}],
   &#39;chains&#39;: [],
   &#39;closed_bucket&#39;: &#39;VeryLikelyOpen&#39;,
   &#39;distance&#39;: 350,
   &#39;geocodes&#39;: {&#39;drop_off&#39;: {&#39;latitude&#39;: 51.455446, &#39;longitude&#39;: -2.600694},
    &#39;main&#39;: {&#39;latitude&#39;: 51.45533, &#39;longitude&#39;: -2.600682},
    &#39;roof&#39;: {&#39;latitude&#39;: 51.45533, &#39;longitude&#39;: -2.600682}},
   &#39;link&#39;: &#39;/v3/places/557d9e15498e3fc4dda1ec92&#39;,
   &#39;location&#39;: {&#39;address&#39;: &#39;16 Park Row&#39;,
    &#39;admin_region&#39;: &#39;England&#39;,
    &#39;country&#39;: &#39;GB&#39;,
    &#39;cross_street&#39;: &#39;&#39;,
    &#39;formatted_address&#39;: &#39;16 Park Row, Bristol, BS1 5LJ&#39;,
    &#39;locality&#39;: &#39;Bristol&#39;,
    &#39;post_town&#39;: &#39;Bristol&#39;,
    &#39;postcode&#39;: &#39;BS1 5LJ&#39;,
    &#39;region&#39;: &#39;Bristol&#39;},
   &#39;name&#39;: &#39;Sotiris Bakery&#39;,
   &#39;related_places&#39;: {},
   &#39;timezone&#39;: &#39;Europe/London&#39;},
  {&#39;fsq_id&#39;: &#39;517e90a0e4b0f7d859cc9578&#39;,
   &#39;categories&#39;: [{&#39;id&#39;: 13036,
     &#39;name&#39;: &#39;Tea Room&#39;,
     &#39;short_name&#39;: &#39;Tea Room&#39;,
     &#39;plural_name&#39;: &#39;Tea Rooms&#39;,
     &#39;icon&#39;: {&#39;prefix&#39;: &#39;https://ss3.4sqi.net/img/categories_v2/food/tearoom_&#39;,
      &#39;suffix&#39;: &#39;.png&#39;}}],
   &#39;chains&#39;: [],
   &#39;closed_bucket&#39;: &#39;VeryLikelyOpen&#39;,
   &#39;distance&#39;: 360,
   &#39;geocodes&#39;: {&#39;main&#39;: {&#39;latitude&#39;: 51.456274, &#39;longitude&#39;: -2.610294},
    &#39;roof&#39;: {&#39;latitude&#39;: 51.456274, &#39;longitude&#39;: -2.610294}},
   &#39;link&#39;: &#39;/v3/places/517e90a0e4b0f7d859cc9578&#39;,
   &#39;location&#39;: {&#39;country&#39;: &#39;GB&#39;, &#39;cross_street&#39;: &#39;&#39;, &#39;formatted_address&#39;: &#39;&#39;},
   &#39;name&#39;: &quot;Ross&#39; Tea Corner&quot;,
   &#39;related_places&#39;: {},
   &#39;timezone&#39;: &#39;Europe/London&#39;},
  {&#39;fsq_id&#39;: &#39;4b6447c0f964a5200ca82ae3&#39;,
   &#39;categories&#39;: [{&#39;id&#39;: 12010,
     &#39;name&#39;: &#39;Adult Education&#39;,
     &#39;short_name&#39;: &#39;Adult Education&#39;,
     &#39;plural_name&#39;: &#39;Adult Education&#39;,
     &#39;icon&#39;: {&#39;prefix&#39;: &#39;https://ss3.4sqi.net/img/categories_v2/building/school_&#39;,
      &#39;suffix&#39;: &#39;.png&#39;}}],
   &#39;chains&#39;: [],
   &#39;closed_bucket&#39;: &#39;VeryLikelyOpen&#39;,
   &#39;distance&#39;: 406,
   &#39;geocodes&#39;: {&#39;main&#39;: {&#39;latitude&#39;: 51.45419, &#39;longitude&#39;: -2.602153},
    &#39;roof&#39;: {&#39;latitude&#39;: 51.45419, &#39;longitude&#39;: -2.602153}},
   &#39;link&#39;: &#39;/v3/places/4b6447c0f964a5200ca82ae3&#39;,
   &#39;location&#39;: {&#39;address&#39;: &#39;40a Park St&#39;,
    &#39;admin_region&#39;: &#39;England&#39;,
    &#39;country&#39;: &#39;GB&#39;,
    &#39;cross_street&#39;: &#39;&#39;,
    &#39;formatted_address&#39;: &#39;40a Park St, Bristol, BS1 5JG&#39;,
    &#39;locality&#39;: &#39;Bristol&#39;,
    &#39;post_town&#39;: &#39;Bristol&#39;,
    &#39;postcode&#39;: &#39;BS1 5JG&#39;,
    &#39;region&#39;: &#39;Bristol&#39;},
   &#39;name&#39;: &#39;Bristol Folk House&#39;,
   &#39;related_places&#39;: {},
   &#39;timezone&#39;: &#39;Europe/London&#39;},
  {&#39;fsq_id&#39;: &#39;5e6235421381060008b18679&#39;,
   &#39;categories&#39;: [{&#39;id&#39;: 13034,
     &#39;name&#39;: &#39;Café&#39;,
     &#39;short_name&#39;: &#39;Café&#39;,
     &#39;plural_name&#39;: &#39;Cafés&#39;,
     &#39;icon&#39;: {&#39;prefix&#39;: &#39;https://ss3.4sqi.net/img/categories_v2/food/cafe_&#39;,
      &#39;suffix&#39;: &#39;.png&#39;}},
    {&#39;id&#39;: 13035,
     &#39;name&#39;: &#39;Coffee Shop&#39;,
     &#39;short_name&#39;: &#39;Coffee Shop&#39;,
     &#39;plural_name&#39;: &#39;Coffee Shops&#39;,
     &#39;icon&#39;: {&#39;prefix&#39;: &#39;https://ss3.4sqi.net/img/categories_v2/food/coffeeshop_&#39;,
      &#39;suffix&#39;: &#39;.png&#39;}},
    {&#39;id&#39;: 13065,
     &#39;name&#39;: &#39;Restaurant&#39;,
     &#39;short_name&#39;: &#39;Restaurant&#39;,
     &#39;plural_name&#39;: &#39;Restaurants&#39;,
     &#39;icon&#39;: {&#39;prefix&#39;: &#39;https://ss3.4sqi.net/img/categories_v2/food/default_&#39;,
      &#39;suffix&#39;: &#39;.png&#39;}}],
   &#39;chains&#39;: [],
   &#39;closed_bucket&#39;: &#39;Unsure&#39;,
   &#39;distance&#39;: 428,
   &#39;geocodes&#39;: {&#39;drop_off&#39;: {&#39;latitude&#39;: 51.459369, &#39;longitude&#39;: -2.609964},
    &#39;main&#39;: {&#39;latitude&#39;: 51.459152, &#39;longitude&#39;: -2.609873},
    &#39;roof&#39;: {&#39;latitude&#39;: 51.459152, &#39;longitude&#39;: -2.609873}},
   &#39;link&#39;: &#39;/v3/places/5e6235421381060008b18679&#39;,
   &#39;location&#39;: {&#39;address&#39;: &#39;St Pauls Rd&#39;,
    &#39;admin_region&#39;: &#39;England&#39;,
    &#39;country&#39;: &#39;GB&#39;,
    &#39;cross_street&#39;: &#39;&#39;,
    &#39;formatted_address&#39;: &#39;St Pauls Rd, Bristol, BS8 1LX&#39;,
    &#39;locality&#39;: &#39;Bristol&#39;,
    &#39;post_town&#39;: &#39;Bristol&#39;,
    &#39;postcode&#39;: &#39;BS8 1LX&#39;,
    &#39;region&#39;: &#39;Bristol&#39;},
   &#39;name&#39;: &#39;Caffe Clifton&#39;,
   &#39;related_places&#39;: {&#39;parent&#39;: {&#39;fsq_id&#39;: &#39;4b058834f964a5204bb822e3&#39;,
     &#39;categories&#39;: [{&#39;id&#39;: 19014,
       &#39;name&#39;: &#39;Hotel&#39;,
       &#39;short_name&#39;: &#39;Hotel&#39;,
       &#39;plural_name&#39;: &#39;Hotels&#39;,
       &#39;icon&#39;: {&#39;prefix&#39;: &#39;https://ss3.4sqi.net/img/categories_v2/travel/hotel_&#39;,
        &#39;suffix&#39;: &#39;.png&#39;}}],
     &#39;name&#39;: &#39;The Clifton Hotel&#39;}},
   &#39;timezone&#39;: &#39;Europe/London&#39;},
  {&#39;fsq_id&#39;: &#39;4ce3baeea3c6721ed2df11cf&#39;,
   &#39;categories&#39;: [{&#39;id&#39;: 13034,
     &#39;name&#39;: &#39;Café&#39;,
     &#39;short_name&#39;: &#39;Café&#39;,
     &#39;plural_name&#39;: &#39;Cafés&#39;,
     &#39;icon&#39;: {&#39;prefix&#39;: &#39;https://ss3.4sqi.net/img/categories_v2/food/cafe_&#39;,
      &#39;suffix&#39;: &#39;.png&#39;}},
    {&#39;id&#39;: 13065,
     &#39;name&#39;: &#39;Restaurant&#39;,
     &#39;short_name&#39;: &#39;Restaurant&#39;,
     &#39;plural_name&#39;: &#39;Restaurants&#39;,
     &#39;icon&#39;: {&#39;prefix&#39;: &#39;https://ss3.4sqi.net/img/categories_v2/food/default_&#39;,
      &#39;suffix&#39;: &#39;.png&#39;}}],
   &#39;chains&#39;: [],
   &#39;closed_bucket&#39;: &#39;VeryLikelyOpen&#39;,
   &#39;distance&#39;: 440,
   &#39;geocodes&#39;: {&#39;drop_off&#39;: {&#39;latitude&#39;: 51.458888, &#39;longitude&#39;: -2.611066},
    &#39;main&#39;: {&#39;latitude&#39;: 51.458696, &#39;longitude&#39;: -2.61096},
    &#39;roof&#39;: {&#39;latitude&#39;: 51.458696, &#39;longitude&#39;: -2.61096}},
   &#39;link&#39;: &#39;/v3/places/4ce3baeea3c6721ed2df11cf&#39;,
   &#39;location&#39;: {&#39;address&#39;: &quot;St Paul&#39;s Rd&quot;,
    &#39;country&#39;: &#39;GB&#39;,
    &#39;cross_street&#39;: &#39;&#39;,
    &#39;formatted_address&#39;: &quot;St Paul&#39;s Rd, Bristol&quot;,
    &#39;locality&#39;: &#39;Bristol&#39;,
    &#39;post_town&#39;: &#39;Bristol&#39;,
    &#39;region&#39;: &#39;Bristol&#39;},
   &#39;name&#39;: &#39;Caffe Clifton&#39;,
   &#39;related_places&#39;: {},
   &#39;timezone&#39;: &#39;Europe/London&#39;},
  {&#39;fsq_id&#39;: &#39;59bd2120da5ede2141070f99&#39;,
   &#39;categories&#39;: [{&#39;id&#39;: 13034,
     &#39;name&#39;: &#39;Café&#39;,
     &#39;short_name&#39;: &#39;Café&#39;,
     &#39;plural_name&#39;: &#39;Cafés&#39;,
     &#39;icon&#39;: {&#39;prefix&#39;: &#39;https://ss3.4sqi.net/img/categories_v2/food/cafe_&#39;,
      &#39;suffix&#39;: &#39;.png&#39;}},
    {&#39;id&#39;: 13040,
     &#39;name&#39;: &#39;Dessert Shop&#39;,
     &#39;short_name&#39;: &#39;Desserts&#39;,
     &#39;plural_name&#39;: &#39;Dessert Shops&#39;,
     &#39;icon&#39;: {&#39;prefix&#39;: &#39;https://ss3.4sqi.net/img/categories_v2/food/dessert_&#39;,
      &#39;suffix&#39;: &#39;.png&#39;}},
    {&#39;id&#39;: 13065,
     &#39;name&#39;: &#39;Restaurant&#39;,
     &#39;short_name&#39;: &#39;Restaurant&#39;,
     &#39;plural_name&#39;: &#39;Restaurants&#39;,
     &#39;icon&#39;: {&#39;prefix&#39;: &#39;https://ss3.4sqi.net/img/categories_v2/food/default_&#39;,
      &#39;suffix&#39;: &#39;.png&#39;}}],
   &#39;chains&#39;: [],
   &#39;closed_bucket&#39;: &#39;VeryLikelyOpen&#39;,
   &#39;distance&#39;: 458,
   &#39;geocodes&#39;: {&#39;main&#39;: {&#39;latitude&#39;: 51.453793, &#39;longitude&#39;: -2.601547},
    &#39;roof&#39;: {&#39;latitude&#39;: 51.453793, &#39;longitude&#39;: -2.601547}},
   &#39;link&#39;: &#39;/v3/places/59bd2120da5ede2141070f99&#39;,
   &#39;location&#39;: {&#39;address&#39;: &#39;20 Park St&#39;,
    &#39;admin_region&#39;: &#39;England&#39;,
    &#39;country&#39;: &#39;GB&#39;,
    &#39;cross_street&#39;: &#39;&#39;,
    &#39;formatted_address&#39;: &#39;20 Park St, Bristol, BS1 5JA&#39;,
    &#39;locality&#39;: &#39;Bristol&#39;,
    &#39;post_town&#39;: &#39;Bristol&#39;,
    &#39;postcode&#39;: &#39;BS1 5JA&#39;,
    &#39;region&#39;: &#39;Bristol&#39;},
   &#39;name&#39;: &#39;Mrs. Potts Chocolate House&#39;,
   &#39;related_places&#39;: {},
   &#39;timezone&#39;: &#39;Europe/London&#39;},
  {&#39;fsq_id&#39;: &#39;4c3469ed3ffc952179da90f5&#39;,
   &#39;categories&#39;: [{&#39;id&#39;: 13034,
     &#39;name&#39;: &#39;Café&#39;,
     &#39;short_name&#39;: &#39;Café&#39;,
     &#39;plural_name&#39;: &#39;Cafés&#39;,
     &#39;icon&#39;: {&#39;prefix&#39;: &#39;https://ss3.4sqi.net/img/categories_v2/food/cafe_&#39;,
      &#39;suffix&#39;: &#39;.png&#39;}},
    {&#39;id&#39;: 13035,
     &#39;name&#39;: &#39;Coffee Shop&#39;,
     &#39;short_name&#39;: &#39;Coffee Shop&#39;,
     &#39;plural_name&#39;: &#39;Coffee Shops&#39;,
     &#39;icon&#39;: {&#39;prefix&#39;: &#39;https://ss3.4sqi.net/img/categories_v2/food/coffeeshop_&#39;,
      &#39;suffix&#39;: &#39;.png&#39;}},
    {&#39;id&#39;: 13065,
     &#39;name&#39;: &#39;Restaurant&#39;,
     &#39;short_name&#39;: &#39;Restaurant&#39;,
     &#39;plural_name&#39;: &#39;Restaurants&#39;,
     &#39;icon&#39;: {&#39;prefix&#39;: &#39;https://ss3.4sqi.net/img/categories_v2/food/default_&#39;,
      &#39;suffix&#39;: &#39;.png&#39;}}],
   &#39;chains&#39;: [],
   &#39;closed_bucket&#39;: &#39;VeryLikelyOpen&#39;,
   &#39;distance&#39;: 462,
   &#39;geocodes&#39;: {&#39;main&#39;: {&#39;latitude&#39;: 51.460572, &#39;longitude&#39;: -2.60179},
    &#39;roof&#39;: {&#39;latitude&#39;: 51.460572, &#39;longitude&#39;: -2.60179}},
   &#39;link&#39;: &#39;/v3/places/4c3469ed3ffc952179da90f5&#39;,
   &#39;location&#39;: {&#39;address&#39;: &#39;135 St. Michaels Hill&#39;,
    &#39;admin_region&#39;: &#39;England&#39;,
    &#39;country&#39;: &#39;GB&#39;,
    &#39;cross_street&#39;: &#39;at Highbury Villas&#39;,
    &#39;formatted_address&#39;: &#39;135 St. Michaels Hill (at Highbury Villas), Bristol, BS2 8BS&#39;,
    &#39;locality&#39;: &#39;Bristol&#39;,
    &#39;post_town&#39;: &#39;Bristol&#39;,
    &#39;postcode&#39;: &#39;BS2 8BS&#39;},
   &#39;name&#39;: &#39;Twoday Coffee Roasters&#39;,
   &#39;related_places&#39;: {},
   &#39;timezone&#39;: &#39;Europe/London&#39;},
  {&#39;fsq_id&#39;: &#39;4b058837f964a520deb822e3&#39;,
   &#39;categories&#39;: [{&#39;id&#39;: 13034,
     &#39;name&#39;: &#39;Café&#39;,
     &#39;short_name&#39;: &#39;Café&#39;,
     &#39;plural_name&#39;: &#39;Cafés&#39;,
     &#39;icon&#39;: {&#39;prefix&#39;: &#39;https://ss3.4sqi.net/img/categories_v2/food/cafe_&#39;,
      &#39;suffix&#39;: &#39;.png&#39;}},
    {&#39;id&#39;: 13035,
     &#39;name&#39;: &#39;Coffee Shop&#39;,
     &#39;short_name&#39;: &#39;Coffee Shop&#39;,
     &#39;plural_name&#39;: &#39;Coffee Shops&#39;,
     &#39;icon&#39;: {&#39;prefix&#39;: &#39;https://ss3.4sqi.net/img/categories_v2/food/coffeeshop_&#39;,
      &#39;suffix&#39;: &#39;.png&#39;}},
    {&#39;id&#39;: 13065,
     &#39;name&#39;: &#39;Restaurant&#39;,
     &#39;short_name&#39;: &#39;Restaurant&#39;,
     &#39;plural_name&#39;: &#39;Restaurants&#39;,
     &#39;icon&#39;: {&#39;prefix&#39;: &#39;https://ss3.4sqi.net/img/categories_v2/food/default_&#39;,
      &#39;suffix&#39;: &#39;.png&#39;}}],
   &#39;chains&#39;: [],
   &#39;closed_bucket&#39;: &#39;VeryLikelyOpen&#39;,
   &#39;distance&#39;: 464,
   &#39;geocodes&#39;: {&#39;main&#39;: {&#39;latitude&#39;: 51.453685, &#39;longitude&#39;: -2.601516},
    &#39;roof&#39;: {&#39;latitude&#39;: 51.453685, &#39;longitude&#39;: -2.601516}},
   &#39;link&#39;: &#39;/v3/places/4b058837f964a520deb822e3&#39;,
   &#39;location&#39;: {&#39;address&#39;: &#39;18 Park St&#39;,
    &#39;admin_region&#39;: &#39;England&#39;,
    &#39;country&#39;: &#39;GB&#39;,
    &#39;cross_street&#39;: &#39;&#39;,
    &#39;formatted_address&#39;: &#39;18 Park St, Bristol, BS1 5JA&#39;,
    &#39;locality&#39;: &#39;Bristol&#39;,
    &#39;post_town&#39;: &#39;Bristol&#39;,
    &#39;postcode&#39;: &#39;BS1 5JA&#39;,
    &#39;region&#39;: &#39;Bristol&#39;},
   &#39;name&#39;: &#39;Woodes&#39;,
   &#39;related_places&#39;: {},
   &#39;timezone&#39;: &#39;Europe/London&#39;},
  {&#39;fsq_id&#39;: &#39;59ac098a86bc494d39e6effc&#39;,
   &#39;categories&#39;: [{&#39;id&#39;: 13034,
     &#39;name&#39;: &#39;Café&#39;,
     &#39;short_name&#39;: &#39;Café&#39;,
     &#39;plural_name&#39;: &#39;Cafés&#39;,
     &#39;icon&#39;: {&#39;prefix&#39;: &#39;https://ss3.4sqi.net/img/categories_v2/food/cafe_&#39;,
      &#39;suffix&#39;: &#39;.png&#39;}},
    {&#39;id&#39;: 13003,
     &#39;name&#39;: &#39;Bar&#39;,
     &#39;short_name&#39;: &#39;Bar&#39;,
     &#39;plural_name&#39;: &#39;Bars&#39;,
     &#39;icon&#39;: {&#39;prefix&#39;: &#39;https://ss3.4sqi.net/img/categories_v2/nightlife/pub_&#39;,
      &#39;suffix&#39;: &#39;.png&#39;}}],
   &#39;chains&#39;: [],
   &#39;closed_bucket&#39;: &#39;LikelyOpen&#39;,
   &#39;distance&#39;: 469,
   &#39;geocodes&#39;: {&#39;main&#39;: {&#39;latitude&#39;: 51.457739, &#39;longitude&#39;: -2.612143},
    &#39;roof&#39;: {&#39;latitude&#39;: 51.457739, &#39;longitude&#39;: -2.612143}},
   &#39;link&#39;: &#39;/v3/places/59ac098a86bc494d39e6effc&#39;,
   &#39;location&#39;: {&#39;address&#39;: &#39;99 Queens Rd&#39;,
    &#39;admin_region&#39;: &#39;England&#39;,
    &#39;country&#39;: &#39;GB&#39;,
    &#39;cross_street&#39;: &#39;&#39;,
    &#39;formatted_address&#39;: &#39;99 Queens Rd, Bristol, BS8 1LW&#39;,
    &#39;locality&#39;: &#39;Bristol&#39;,
    &#39;post_town&#39;: &#39;Bristol&#39;,
    &#39;postcode&#39;: &#39;BS8 1LW&#39;,
    &#39;region&#39;: &#39;Bristol&#39;},
   &#39;name&#39;: &#39;99 Queens&#39;,
   &#39;related_places&#39;: {},
   &#39;timezone&#39;: &#39;Europe/London&#39;}],
 &#39;context&#39;: {&#39;geo_bounds&#39;: {&#39;circle&#39;: {&#39;center&#39;: {&#39;latitude&#39;: 51.45712270688956,
     &#39;longitude&#39;: -2.605159893254094},
    &#39;radius&#39;: 500}}}}
</pre></div>
</div>
</div>
</div>
<p>Next, to convert <code class="docutils literal notranslate"><span class="pre">json</span></code> format to tables (i.e. <code class="docutils literal notranslate"><span class="pre">dataframe</span></code>), we can use a <code class="docutils literal notranslate"><span class="pre">for-loop</span></code>. Note that there are many other ways of executing such a conversion.</p>
<p>In the code below, we only extract the id, name, address, and coordinates of the places.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">places</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">place</span> <span class="ow">in</span> <span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">]:</span>
    <span class="n">fsq_id</span> <span class="o">=</span> <span class="n">place</span><span class="p">[</span><span class="s1">&#39;fsq_id&#39;</span><span class="p">]</span>
    <span class="n">coords</span> <span class="o">=</span> <span class="n">place</span><span class="p">[</span><span class="s1">&#39;geocodes&#39;</span><span class="p">][</span><span class="s1">&#39;main&#39;</span><span class="p">]</span>
    <span class="n">address</span> <span class="o">=</span> <span class="n">place</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">][</span><span class="s1">&#39;formatted_address&#39;</span><span class="p">]</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">place</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
    <span class="n">places</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">fsq_id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">coords</span><span class="p">))</span>
    
<span class="n">places_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">places</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="s1">&#39;Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Address&#39;</span><span class="p">,</span> <span class="s1">&#39;Coords&#39;</span><span class="p">])</span>
<span class="n">places_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID</th>
      <th>Name</th>
      <th>Address</th>
      <th>Coords</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>4b058836f964a520ceb822e3</td>
      <td>Boston Tea Party</td>
      <td>75 Park St, Bristol, BS1 5PF</td>
      <td>{'latitude': 51.455219, 'longitude': -2.603972}</td>
    </tr>
    <tr>
      <th>1</th>
      <td>557d9e15498e3fc4dda1ec92</td>
      <td>Sotiris Bakery</td>
      <td>16 Park Row, Bristol, BS1 5LJ</td>
      <td>{'latitude': 51.45533, 'longitude': -2.600682}</td>
    </tr>
    <tr>
      <th>2</th>
      <td>517e90a0e4b0f7d859cc9578</td>
      <td>Ross' Tea Corner</td>
      <td></td>
      <td>{'latitude': 51.456274, 'longitude': -2.610294}</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4b6447c0f964a5200ca82ae3</td>
      <td>Bristol Folk House</td>
      <td>40a Park St, Bristol, BS1 5JG</td>
      <td>{'latitude': 51.45419, 'longitude': -2.602153}</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5e6235421381060008b18679</td>
      <td>Caffe Clifton</td>
      <td>St Pauls Rd, Bristol, BS8 1LX</td>
      <td>{'latitude': 51.459152, 'longitude': -2.609873}</td>
    </tr>
    <tr>
      <th>5</th>
      <td>4ce3baeea3c6721ed2df11cf</td>
      <td>Caffe Clifton</td>
      <td>St Paul's Rd, Bristol</td>
      <td>{'latitude': 51.458696, 'longitude': -2.61096}</td>
    </tr>
    <tr>
      <th>6</th>
      <td>59bd2120da5ede2141070f99</td>
      <td>Mrs. Potts Chocolate House</td>
      <td>20 Park St, Bristol, BS1 5JA</td>
      <td>{'latitude': 51.453793, 'longitude': -2.601547}</td>
    </tr>
    <tr>
      <th>7</th>
      <td>4c3469ed3ffc952179da90f5</td>
      <td>Twoday Coffee Roasters</td>
      <td>135 St. Michaels Hill (at Highbury Villas), Br...</td>
      <td>{'latitude': 51.460572, 'longitude': -2.60179}</td>
    </tr>
    <tr>
      <th>8</th>
      <td>4b058837f964a520deb822e3</td>
      <td>Woodes</td>
      <td>18 Park St, Bristol, BS1 5JA</td>
      <td>{'latitude': 51.453685, 'longitude': -2.601516}</td>
    </tr>
    <tr>
      <th>9</th>
      <td>59ac098a86bc494d39e6effc</td>
      <td>99 Queens</td>
      <td>99 Queens Rd, Bristol, BS8 1LW</td>
      <td>{'latitude': 51.457739, 'longitude': -2.612143}</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>You can further get more information about the place. One example is to extract the description (unstructured text) of each place using the following code. Again, we <code class="docutils literal notranslate"><span class="pre">request</span></code> to the API by setting up some parameters here: to include <code class="docutils literal notranslate"><span class="pre">fsq_id</span></code> in the <code class="docutils literal notranslate"><span class="pre">url</span></code>, and pass the parameter <code class="docutils literal notranslate"><span class="pre">fields</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">description_list</span> <span class="o">=</span> <span class="p">[]</span> 

<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">places_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">fsq_id</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://api.foursquare.com/v3/places/</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fsq_id</span><span class="p">)</span>
    <span class="n">params</span> <span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;fields&quot;</span><span class="p">:</span><span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="c1"># you can also get &quot;tips&quot;</span>
    <span class="p">}</span>

    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;accept&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="s2">&quot;fsq3o8iIO/yZccIR5QzSI1Jmz0RX3vJ2HXCkuJVDwk9o6rQ=&quot;</span>
    <span class="p">}</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">description_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">description</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">])</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">description_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
    
</pre></div>
</div>
</div>
</div>
<p>One question: why we write a <code class="docutils literal notranslate"><span class="pre">try:</span>&#160; <span class="pre">except:</span></code> block here?</p>
<p>Finally, we can add the extracted description to the data frame: <code class="docutils literal notranslate"><span class="pre">places_df</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">places_df</span><span class="p">[</span><span class="s1">&#39;Description&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">description_list</span>
<span class="n">places_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID</th>
      <th>Name</th>
      <th>Address</th>
      <th>Coords</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>4b058836f964a520ceb822e3</td>
      <td>Boston Tea Party</td>
      <td>75 Park St, Bristol, BS1 5PF</td>
      <td>{'latitude': 51.455219, 'longitude': -2.603972}</td>
      <td>This is our first &amp; flagship café. Opened in 1...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>557d9e15498e3fc4dda1ec92</td>
      <td>Sotiris Bakery</td>
      <td>16 Park Row, Bristol, BS1 5LJ</td>
      <td>{'latitude': 51.45533, 'longitude': -2.600682}</td>
      <td>Specialists in Greek Pastries and Pies. Specia...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>517e90a0e4b0f7d859cc9578</td>
      <td>Ross' Tea Corner</td>
      <td></td>
      <td>{'latitude': 51.456274, 'longitude': -2.610294}</td>
      <td>None</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4b6447c0f964a5200ca82ae3</td>
      <td>Bristol Folk House</td>
      <td>40a Park St, Bristol, BS1 5JG</td>
      <td>{'latitude': 51.45419, 'longitude': -2.602153}</td>
      <td>None</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5e6235421381060008b18679</td>
      <td>Caffe Clifton</td>
      <td>St Pauls Rd, Bristol, BS8 1LX</td>
      <td>{'latitude': 51.459152, 'longitude': -2.609873}</td>
      <td>None</td>
    </tr>
    <tr>
      <th>5</th>
      <td>4ce3baeea3c6721ed2df11cf</td>
      <td>Caffe Clifton</td>
      <td>St Paul's Rd, Bristol</td>
      <td>{'latitude': 51.458696, 'longitude': -2.61096}</td>
      <td>None</td>
    </tr>
    <tr>
      <th>6</th>
      <td>59bd2120da5ede2141070f99</td>
      <td>Mrs. Potts Chocolate House</td>
      <td>20 Park St, Bristol, BS1 5JA</td>
      <td>{'latitude': 51.453793, 'longitude': -2.601547}</td>
      <td>None</td>
    </tr>
    <tr>
      <th>7</th>
      <td>4c3469ed3ffc952179da90f5</td>
      <td>Twoday Coffee Roasters</td>
      <td>135 St. Michaels Hill (at Highbury Villas), Br...</td>
      <td>{'latitude': 51.460572, 'longitude': -2.60179}</td>
      <td>None</td>
    </tr>
    <tr>
      <th>8</th>
      <td>4b058837f964a520deb822e3</td>
      <td>Woodes</td>
      <td>18 Park St, Bristol, BS1 5JA</td>
      <td>{'latitude': 51.453685, 'longitude': -2.601516}</td>
      <td>None</td>
    </tr>
    <tr>
      <th>9</th>
      <td>59ac098a86bc494d39e6effc</td>
      <td>99 Queens</td>
      <td>99 Queens Rd, Bristol, BS8 1LW</td>
      <td>{'latitude': 51.457739, 'longitude': -2.612143}</td>
      <td>None</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="part-1-2-extracting-geo-text-from-twitter">
<h2>Part 1-2: Extracting (geo)text from Twitter<a class="headerlink" href="#part-1-2-extracting-geo-text-from-twitter" title="Permalink to this heading">#</a></h2>
<p>This part explains how to extract text-based unstructured information from the social media Twitter via its API. Similar pipline can be used to extract information from other types of social media/Web services (e.g., Foursquare, Yelp, Flickr, Google Places, etc.).</p>
<p>Twitter is a useful data source for studying the social impact of events and activities. In this part, we are going to learn how to collect Twitter data using its API. Specifically, we are going to focus on geotagged Twitter data.</p>
<p>First, Twitter requires the users of Twitter API to be authenticated by the system. One simple approach to obtain such authentication is by registering a Twitter account. This is the approach we are going to take in this tutorial.</p>
<p>Go to the website of Twitter: <a class="reference external" href="https://twitter.com/">https://twitter.com/</a> , and click “Sign up” at the upper right corner. You can skip this step if you already have a Twitter account.</p>
<p>After you have registered/logged in to your Twitter account, we are going to obtain the keys that are necessary to use Twitter API. Go to <a class="reference external" href="https://apps.twitter.com/">https://apps.twitter.com/</a> , and sign in using the Twitter account you have just created
(sometimes the browser will automatically sign you in).</p>
<p>After you have signed in, click the button “Create New App”. Then fill in the necessary information to create an APP. Note that you might need to record your phone number in your Twitter account in order to do so. If you don’t like it, feel free to remove your phone number from your account after you have done your project.</p>
<p>Then you will be directed to a page (see example below) asking you for a name of your App. Give it a name that you want.</p>
<p><img alt="Get Keys from Twitter Developer" src="../_images/lab2-fig1.png" /></p>
<p>Click <code class="docutils literal notranslate"><span class="pre">Get</span> <span class="pre">keys</span></code>. It will then generated API Key, API Key Secret, and Bearer Token (see below for an example). Make sure you copy and paste them into a safe place (e.g., a text editor). We need these authentications later.</p>
<p><img alt="Authentication Example" src="../_images/lab2-fig2.png" /></p>
<p>Next, we also need to obtain the Access Token and its key. To do so, go to the <code class="docutils literal notranslate"><span class="pre">Projects</span> <span class="pre">&amp;</span> <span class="pre">Apps</span></code>–&gt; Select your App. Then click <code class="docutils literal notranslate"><span class="pre">Keys</span> <span class="pre">and</span> <span class="pre">tokens</span></code>, and then click <code class="docutils literal notranslate"><span class="pre">Generate</span></code> on the right of <code class="docutils literal notranslate"><span class="pre">Access</span> <span class="pre">Token</span> <span class="pre">and</span> <span class="pre">Secret</span></code> (see below). Again, make sure you record them in a safe place. We need them later. Note that if for some reasons, you lose your tokens and secrets, this page is where you regenerate them.</p>
<p><img alt="Access Token Example" src="../_images/lab2-fig3.png" /></p>
<p>Once you have your Twitter app set-up, you are ready to access tweets in Python. Begin by importing the necessary Python libraries.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">tweepy</span> <span class="k">as</span> <span class="nn">tw</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>
</div>
<p>To access the Twitter API, you will need four things from your Twitter App page. These keys are located in your Twitter app settings in the Keys and Access Tokens tab.</p>
<ul class="simple">
<li><p>api key</p></li>
<li><p>api key seceret</p></li>
<li><p>access token</p></li>
<li><p>access token secret</p></li>
</ul>
<p>Below I put in my authentications. You should use yours! But remember to not share these with anyone else because these values are specific to your App.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">api_key</span><span class="o">=</span> <span class="s1">&#39;ADsWr3cgAce13adabpK0aVKh5&#39;</span>
<span class="n">api_key_secret</span><span class="o">=</span> <span class="s1">&#39;9EPHVN4OdcsnizwMIu5zvNarbWfybuXMQou6Mz0WDEZehTynMz&#39;</span>
<span class="n">access_token</span><span class="o">=</span> <span class="s1">&#39;1582847729486684180-FqKFjuAorSXQlLcQ8f8niWK7HyDWMN&#39;</span>
<span class="n">access_token_secret</span> <span class="o">=</span> <span class="s1">&#39;TSjdYCWluaenbiXb2cxSA6rR7AxTkEPzDJ1Znd8J4225q&#39;</span>
</pre></div>
</div>
<p>With these authentications, we can next build an API variable in Python that build the connection between this Jupyter program and Twitter:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">auth</span> <span class="o">=</span> <span class="n">tw</span><span class="o">.</span><span class="n">OAuthHandler</span><span class="p">(</span><span class="n">api_key</span><span class="p">,</span> <span class="n">api_key_secret</span><span class="p">)</span>
<span class="n">auth</span><span class="o">.</span><span class="n">set_access_token</span><span class="p">(</span><span class="n">access_token</span><span class="p">,</span> <span class="n">access_token_secret</span><span class="p">)</span>
<span class="n">api</span> <span class="o">=</span> <span class="n">tw</span><span class="o">.</span><span class="n">API</span><span class="p">(</span><span class="n">auth</span><span class="p">,</span> <span class="n">wait_on_rate_limit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>For example, now we can send tweets using your API access. Note that your tweet needs to be 280 characters or less:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Post a tweet from Python</span>
<span class="n">api</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span><span class="s2">&quot;Hello Twitter, I&#39;m sending the first message via Python to you! I learnt it from GEOGM0068. #DataScience&quot;</span><span class="p">)</span>
<span class="c1"># Your tweet has been posted!</span>
</pre></div>
</div>
<p>If you go to your Twitter account and check Profile, you will see the tweet being posted! Congrats for your first post via Python!</p>
<p>Note that if you see errors like “453 - You currently have Essential access which includes access to Twitter API v2 endpoints only. If you need access to this endpoint, you’ll need to apply for Elevated access via the Developer Portal. You can learn more here: <a class="reference external" href="https://developer.twitter.com/en/docs/twitter-api/getting-started/about-twitter-api#v2-access-leve">https://developer.twitter.com/en/docs/twitter-api/getting-started/about-twitter-api#v2-access-leve</a>”. It means you need to elevate your access. What you need to do is (1). Go to Products –&gt; Twitter API v2; (2). click the tab “Elevated” (or “Academic Research” if you need it for your dissertation later); (3). Click <code class="docutils literal notranslate"><span class="pre">Apply</span></code>, then file the form (you can choose No for many of the questions). See screenshot below for (1) and (2):</p>
<p><img alt="Elevate your access" src="../_images/lab2-fig4.png" /></p>
<p>Next, let’s retrieve (search) some tweets that are about <code class="docutils literal notranslate"><span class="pre">#energycrisis</span></code> that are posted currently in English. There are going to be many posts returned. To make it easy to illustrate and to save some request (note you have a limited number of requests via this API), we only request 5 from the list.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">search_words</span> <span class="o">=</span> <span class="s2">&quot;#energycrisis&quot;</span>
<span class="n">tweets</span> <span class="o">=</span> <span class="n">tw</span><span class="o">.</span><span class="n">Cursor</span><span class="p">(</span><span class="n">api</span><span class="o">.</span><span class="n">search_tweets</span><span class="p">,</span>
              <span class="n">q</span><span class="o">=</span><span class="n">search_words</span><span class="p">,</span>
              <span class="n">lang</span><span class="o">=</span><span class="s2">&quot;en&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">tweets</span>
</pre></div>
</div>
<p>Here, you see a  an object that you can iterate (i.e. <code class="docutils literal notranslate"><span class="pre">ItemIterator</span></code>) or loop over to access the data collected. Each item in the iterator has various attributes that you can access to get information about each tweet including:</p>
<ul class="simple">
<li><p>the text of the tweet</p></li>
<li><p>who sent the tweet</p></li>
<li><p>the date the tweet was sent</p></li>
</ul>
<p>and more. The code below loops through the object and save the time of the tweet, the user who posted the tweet, the text of the tweet, as well ast the user location to a pandas <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># create dataframe</span>
<span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="s1">&#39;Tweet&#39;</span><span class="p">,</span> <span class="s1">&#39;Location&#39;</span><span class="p">]</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">tweet</span> <span class="ow">in</span> <span class="n">tweets</span><span class="p">:</span>
    <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">tweet</span><span class="o">.</span><span class="n">created_at</span><span class="p">,</span> <span class="n">tweet</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">screen_name</span><span class="p">,</span> <span class="n">tweet</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">tweet</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">location</span><span class="p">])</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
</pre></div>
</div>
<p>We can further save the dataframe to a local csv file (structured data):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;tweets_example.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that there is another way of writing the query to Twitter API, which might be more intuitive to some users. For example, you can replace <code class="docutils literal notranslate"><span class="pre">tweets</span> <span class="pre">=</span> <span class="pre">tw.Cursor(api.search_tweets,q=search_words,lang=&quot;en&quot;).items(5)</span></code> to something like:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tweets2</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">search_tweets</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="n">search_words</span><span class="p">,</span><span class="n">lang</span><span class="o">=</span><span class="s2">&quot;en&quot;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="s2">&quot;5&quot;</span><span class="p">)</span>
<span class="n">data2</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">tweet2</span> <span class="ow">in</span> <span class="n">tweets2</span><span class="p">:</span>
    <span class="n">data2</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">tweet2</span><span class="o">.</span><span class="n">created_at</span><span class="p">,</span> <span class="n">tweet2</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">screen_name</span><span class="p">,</span> <span class="n">tweet2</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">tweet2</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">location</span><span class="p">])</span>
<span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data2</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
</pre></div>
</div>
<p>To learn more about the key function <code class="docutils literal notranslate"><span class="pre">search_tweets()</span></code>, check its webpage <a class="reference external" href="https://docs.tweepy.org/en/stable/api.html#tweepy.API.search_tweets">here</a>. Please try yourself to set up some other parameters to see what you can get.</p>
</section>
<section id="part-2-basic-natural-language-processing-and-geoparsing">
<h2>Part 2: Basic Natural Language Processing and Geoparsing<a class="headerlink" href="#part-2-basic-natural-language-processing-and-geoparsing" title="Permalink to this heading">#</a></h2>
<p>To extract places (or other categories) from text-based (unstructured) data, we need to do some basic Natural Language Processing (NLP), such as tokenization and Part-of-Speech analysis. All these operations can be done through the library <code class="docutils literal notranslate"><span class="pre">spaCy</span></code>.</p>
<p>Ideally, you can use the tweets you got from Part 1 to do the experiment. But since sometimes the tweets you get might be very heterogenous and noisy, here we use a clean example (you can also get it from some long news online) to show how to use <code class="docutils literal notranslate"><span class="pre">spaCy</span></code> in order to make sure all important points are covered in one example.</p>
<p>First make sure you have intsalled and imported <code class="docutils literal notranslate"><span class="pre">spaCy</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">spacy</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">spaCy</span></code> comes with pretrained NLP models that can perform most common NLP tasks, such as tokenization, parts of speech (POS) tagging, named entity recognition (NER), transforming to word vectors etc.</p>
<p>If you are dealing with a particular language, you can load the spacy model specific to the language using <code class="docutils literal notranslate"><span class="pre">spacy.load()</span></code> function. For example, we want to load the English version:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load small english model: https://spacy.io/models</span>
<span class="c1"># If you see errors like &quot;OSError: [E050] Can&#39;t find model &#39;en_core_web_sm&#39;. It doesn&#39;t seem to be a shortcut link, a Python package or a valid path to a data directory.&quot;, it means your system has not installed the corresponding language models yet. </span>
<span class="c1"># Use the commond to install it: python -m spacy download en </span>
<span class="n">nlp</span><span class="o">=</span><span class="n">spacy</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;en_core_web_sm&quot;</span><span class="p">)</span>
<span class="n">nlp</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;spacy.lang.en.English at 0x16bb349e0&gt;
</pre></div>
</div>
</div>
</div>
<p>This returns a <code class="docutils literal notranslate"><span class="pre">Language</span></code> object that comes ready with multiple built-in capabilities.</p>
<p>Now let’s say you have your text data in a string. What can be done to understand the structure of the text?</p>
<p>First, call the loaded <code class="docutils literal notranslate"><span class="pre">nlp</span></code> object on the text. It should return a processed <code class="docutils literal notranslate"><span class="pre">Doc</span></code> object.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Parse text through the `nlp` model</span>
<span class="n">my_text</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;The economic situation of the country is on edge , as the stock </span>
<span class="s2">market crashed causing loss of millions. Citizens who had their main investment </span>
<span class="s2">in the share-market are facing a great loss. Many companies might lay off </span>
<span class="s2">thousands of people to reduce labor cost&quot;&quot;&quot;</span>

<span class="n">my_doc</span> <span class="o">=</span> <span class="n">nlp</span><span class="p">(</span><span class="n">my_text</span><span class="p">)</span>
<span class="nb">type</span><span class="p">(</span><span class="n">my_doc</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>spacy.tokens.doc.Doc
</pre></div>
</div>
</div>
</div>
<p>Hmmm, it is a <code class="docutils literal notranslate"><span class="pre">Doc</span></code> object. But wait, what is exactly a <code class="docutils literal notranslate"><span class="pre">Doc</span></code> object?</p>
<p>It is a sequence of tokens that contains not just the original text but all the results produced by the <code class="docutils literal notranslate"><span class="pre">spaCy</span></code> model after processing the text. Useful information such as the lemma of the text, whether it is a stop word or not, named entities, the word vector of the text, and so on are pre-computed and readily stored in the <code class="docutils literal notranslate"><span class="pre">Doc</span></code> object.</p>
<p>So first, what is a token?</p>
<p>As you have learnt from the lecture. Tokens are individual textual entities that make up the text. Typically a token can be the words, punctuation, spaces, etc. Tokenization is the process of converting a text into smaller sub-texts, based on certain predefined rules. For example, sentences are tokenized to words (and punctuation optionally). And paragraphs into sentences, depending on the context.</p>
<p>Each token in <code class="docutils literal notranslate"><span class="pre">spaCy</span></code> has different attributes that tell us a great deal of information.</p>
<p>Let’s see the token texts on <code class="docutils literal notranslate"><span class="pre">my_doc</span></code>. The string, which the token represents, can be accessed through the <code class="docutils literal notranslate"><span class="pre">token.text</span></code> attribute.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Printing the tokens of a doc</span>
<span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">my_doc</span><span class="p">:</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The
economic
situation
of
the
country
is
on
edge
,
as
the
stock


market
crashed
causing
loss
of
millions
.
Citizens
who
had
their
main
investment


in
the
share
-
market
are
facing
a
great
loss
.
Many
companies
might
lay
off


thousands
of
people
to
reduce
labor
cost
</pre></div>
</div>
</div>
</div>
<p>The above tokens contain punctuation and common words like “a”, ” the”, “was”, etc. These do not add any value to the meaning of your text. They are called stop words. We can clean it up.</p>
<p>The type of tokens will allow us to clean those noisy tokens such as stop word, punctuation, and space. First, we show whether a token is stop/punctuation or not, and then we use this information to remove them.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Printing tokens and boolean values stored in different attributes</span>
<span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">my_doc</span><span class="p">:</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">text</span><span class="p">,</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">token</span><span class="o">.</span><span class="n">is_stop</span><span class="p">,</span><span class="s1">&#39;---&#39;</span><span class="p">,</span><span class="n">token</span><span class="o">.</span><span class="n">is_punct</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The -- True --- False
economic -- False --- False
situation -- False --- False
of -- True --- False
the -- True --- False
country -- False --- False
is -- True --- False
on -- True --- False
edge -- False --- False
, -- False --- True
as -- True --- False
the -- True --- False
stock -- False --- False

 -- False --- False
market -- False --- False
crashed -- False --- False
causing -- False --- False
loss -- False --- False
of -- True --- False
millions -- False --- False
. -- False --- True
Citizens -- False --- False
who -- True --- False
had -- True --- False
their -- True --- False
main -- False --- False
investment -- False --- False

 -- False --- False
in -- True --- False
the -- True --- False
share -- False --- False
- -- False --- True
market -- False --- False
are -- True --- False
facing -- False --- False
a -- True --- False
great -- False --- False
loss -- False --- False
. -- False --- True
Many -- True --- False
companies -- False --- False
might -- True --- False
lay -- False --- False
off -- True --- False

 -- False --- False
thousands -- False --- False
of -- True --- False
people -- False --- False
to -- True --- False
reduce -- False --- False
labor -- False --- False
cost -- False --- False
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Removing stop words and punctuations</span>
<span class="n">my_doc_cleaned</span> <span class="o">=</span> <span class="p">[</span><span class="n">token</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">my_doc</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">token</span><span class="o">.</span><span class="n">is_stop</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">token</span><span class="o">.</span><span class="n">is_punct</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">token</span><span class="o">.</span><span class="n">is_space</span><span class="p">]</span>

<span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">my_doc_cleaned</span><span class="p">:</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>economic
situation
country
edge
stock
market
crashed
causing
loss
millions
Citizens
main
investment
share
market
facing
great
loss
companies
lay
thousands
people
reduce
labor
cost
</pre></div>
</div>
</div>
</div>
<p>To get the POS tagging of your text, you use code like:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">my_doc_cleaned</span><span class="p">:</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">text</span><span class="p">,</span><span class="s1">&#39;---- &#39;</span><span class="p">,</span><span class="n">token</span><span class="o">.</span><span class="n">pos_</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>economic ----  ADJ
situation ----  NOUN
country ----  NOUN
edge ----  NOUN
stock ----  NOUN
market ----  NOUN
crashed ----  VERB
causing ----  VERB
loss ----  NOUN
millions ----  NOUN
Citizens ----  NOUN
main ----  ADJ
investment ----  NOUN
share ----  NOUN
market ----  NOUN
facing ----  VERB
great ----  ADJ
loss ----  NOUN
companies ----  NOUN
lay ----  VERB
thousands ----  NOUN
people ----  NOUN
reduce ----  VERB
labor ----  NOUN
cost ----  NOUN
</pre></div>
</div>
</div>
</div>
<p>You will see each word (token) now is associated with a POS tag, whether it is a NOUN, a ADJ, a VERB, or so on … POS often can help us disambiguate the meaning of words (or places in GIR).</p>
<p>Btw, if you don’t know what “ADJ” means, you can use code like:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spacy</span><span class="o">.</span><span class="n">explain</span><span class="p">(</span><span class="s1">&#39;ADJ&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;adjective&#39;
</pre></div>
</div>
</div>
</div>
<p>You can also use <code class="docutils literal notranslate"><span class="pre">spaCy</span></code> to do some Named Entity Recognition (including place name identification or geoparsing). For instance:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;Tony Stark owns the company StarkEnterprises . Emily Clark works at Microsoft and lives in Manchester. She loves to read the Bible and learn French&#39;</span>
<span class="n">doc</span><span class="o">=</span><span class="n">nlp</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

<span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="n">doc</span><span class="o">.</span><span class="n">ents</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">entity</span><span class="o">.</span><span class="n">text</span><span class="p">,</span><span class="s1">&#39;--- &#39;</span><span class="p">,</span><span class="n">entity</span><span class="o">.</span><span class="n">label_</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Tony Stark ---  PERSON
StarkEnterprises ---  ORG
Emily Clark ---  PERSON
Microsoft ---  ORG
Manchester ---  GPE
Bible ---  WORK_OF_ART
French ---  LANGUAGE
</pre></div>
</div>
</div>
</div>
<p>What is “GPE”?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spacy</span><span class="o">.</span><span class="n">explain</span><span class="p">(</span><span class="s1">&#39;GPE&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;Countries, cities, states&#39;
</pre></div>
</div>
</div>
</div>
<p>spaCy also provides special visualization for NER through displacy. Using <code class="docutils literal notranslate"><span class="pre">displacy.render()</span></code> function, you can set the <code class="docutils literal notranslate"><span class="pre">style='ent'</span></code> to visualize. For more interesting visualizations, check <a class="reference external" href="https://spacy.io/usage/visualizers">displacy documentation</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Using displacy for visualizing NER</span>
<span class="kn">from</span> <span class="nn">spacy</span> <span class="kn">import</span> <span class="n">displacy</span>
<span class="n">displacy</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;ent&#39;</span><span class="p">,</span><span class="n">jupyter</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span class="tex2jax_ignore"><div class="entities" style="line-height: 2.5; direction: ltr">
<mark class="entity" style="background: #aa9cfc; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    Tony Stark
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem">PERSON</span>
</mark>
 owns the company 
<mark class="entity" style="background: #7aecec; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    StarkEnterprises
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem">ORG</span>
</mark>
 . 
<mark class="entity" style="background: #aa9cfc; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    Emily Clark
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem">PERSON</span>
</mark>
 works at 
<mark class="entity" style="background: #7aecec; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    Microsoft
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem">ORG</span>
</mark>
 and lives in 
<mark class="entity" style="background: #feca74; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    Manchester
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem">GPE</span>
</mark>
. She loves to read the 
<mark class="entity" style="background: #f0d0ff; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    Bible
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem">WORK_OF_ART</span>
</mark>
 and learn 
<mark class="entity" style="background: #ff8197; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    French
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem">LANGUAGE</span>
</mark>
</div></span></div></div>
</div>
<p>So far, you have learnt the basics of retrieving information from social media like Twitter, as well as basic NLP operations and named entity recognition (geoparsing is part of it). I suggest you to play with what you have learnt so far by using new data (maybe through different APIs) to experiment these functions, changing the parameters of function, combining these skills with what you have learn in Tutorial 1 (e.g., <code class="docutils literal notranslate"><span class="pre">geopandas</span></code>), etc.</p>
</section>
<section id="part-3-geocoding-the-recognized-place-names">
<h2>Part 3: Geocoding the recognized place names<a class="headerlink" href="#part-3-geocoding-the-recognized-place-names" title="Permalink to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">spaCy</span></code> helps us recognize different categories of tokens from a text, including place names (with tag <code class="docutils literal notranslate"><span class="pre">GPE</span></code> or <code class="docutils literal notranslate"><span class="pre">LOC</span></code>), but have not refer these place names into geographical locations on the surface of the earth. In this part, we will explore ways of geocoding text-based place names to geographic coordinates. There are several cool libraries/packages there for us to directly use, which we will cover some in this tutorial. But before that, let’s develop our own geocoding tool first. We might not use it in the future due to its simplicity, but it will help us understand the fundementals behind those technologies, which we have highlighted in our lectures.</p>
<p>First, let’s create a variable storing the text that we want to georeference. The text below is copied from the Physical Geography section from the wikipedia page about the UK. We then use <code class="docutils literal notranslate"><span class="pre">nlp()</span></code> to convert the text into a <code class="docutils literal notranslate"><span class="pre">nlp</span></code> object defined by <code class="docutils literal notranslate"><span class="pre">spacy</span></code>. Having this object, we can then extract place names using the label <code class="docutils literal notranslate"><span class="pre">LOC</span></code> and/or <code class="docutils literal notranslate"><span class="pre">GPE</span></code>. Here we use a <code class="docutils literal notranslate"><span class="pre">for-loop</span></code> to go through all the tokens and only get those that have the two location-related labels, and then save them all into a list called <code class="docutils literal notranslate"><span class="pre">locations</span></code>. Finally, we transfer such a list into a <code class="docutils literal notranslate"><span class="pre">panda</span></code> dataframe.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">UK_physicalGeo</span> <span class="o">=</span> <span class="s2">&quot;The physical geography of the UK varies greatly. England consists of mostly lowland terrain, with upland or mountainous terrain only found north-west of the Tees-Exe line. The upland areas include the Lake District, the Pennines, North York Moors, Exmoor and Dartmoor. The lowland areas are typically traversed by ranges of low hills, frequently composed of chalk, and flat plains. Scotland is the most mountainous country in the UK and its physical geography is distinguished by the Highland Boundary Fault which traverses the Scottish mainland from Helensburgh to Stonehaven. The faultline separates the two distinctively different regions of the Highlands to the north and west, and the Lowlands to the south and east. The Highlands are predominantly mountainous, containing the majority of Scotland&#39;s mountainous landscape, while the Lowlands contain flatter land, especially across the Central Lowlands, with upland and mountainous terrain located at the Southern Uplands. Wales is mostly mountainous, though south Wales is less mountainous than north and mid Wales. Northern Ireland consists of mostly hilly landscape and its geography includes the Mourne Mountains as well as Lough Neagh, at 388 square kilometres (150 sq mi), the largest body of water in the UK.[12]The overall geomorphology of the UK was shaped by a combination of forces including tectonics and climate change, in particular glaciation in northern and western areas. The tallest mountain in the UK (and British Isles) is Ben Nevis, in the Grampian Mountains, Scotland. The longest river is the River Severn which flows from Wales into England. The largest lake by surface area is Lough Neagh in Northern Ireland, though Scotland&#39;s Loch Ness has the largest volume.&quot;</span>
<span class="n">UK_physicalGeo_doc</span><span class="o">=</span><span class="n">nlp</span><span class="p">(</span><span class="n">UK_physicalGeo</span><span class="p">)</span>

<span class="n">locations</span> <span class="o">=</span> <span class="p">[]</span> 

<span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="n">UK_physicalGeo_doc</span><span class="o">.</span><span class="n">ents</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">entity</span><span class="o">.</span><span class="n">label_</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;LOC&#39;</span><span class="p">,</span> <span class="s1">&#39;GPE&#39;</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">entity</span><span class="o">.</span><span class="n">text</span><span class="p">,</span><span class="s1">&#39;--- &#39;</span><span class="p">,</span><span class="n">entity</span><span class="o">.</span><span class="n">label_</span><span class="p">)</span>
        <span class="n">locations</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">entity</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">entity</span><span class="o">.</span><span class="n">label_</span><span class="p">])</span>
<span class="n">locations_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">locations</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Place Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Tag&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>UK ---  GPE
England ---  GPE
the Lake District ---  LOC
North York Moors ---  GPE
Scotland ---  GPE
UK ---  GPE
Helensburgh ---  GPE
south ---  LOC
Scotland ---  GPE
Central Lowlands ---  LOC
the Southern Uplands ---  LOC
Wales ---  GPE
Wales ---  GPE
Northern Ireland ---  GPE
the Mourne Mountains ---  LOC
UK ---  GPE
UK ---  GPE
the Grampian Mountains ---  LOC
Scotland ---  GPE
the River Severn ---  LOC
Wales ---  GPE
England ---  GPE
Northern Ireland ---  GPE
Scotland ---  GPE
</pre></div>
</div>
</div>
</div>
<p>Note that we see many duplicates in the list. What we can do is to delete those duplicates. <code class="docutils literal notranslate"><span class="pre">pandas</span></code> provides a very easy function for us to do it: <code class="docutils literal notranslate"><span class="pre">drop_duplicates()</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">locations_df</span> <span class="o">=</span> <span class="n">locations_df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
<span class="n">locations_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Place Name</th>
      <th>Tag</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>UK</td>
      <td>GPE</td>
    </tr>
    <tr>
      <th>1</th>
      <td>England</td>
      <td>GPE</td>
    </tr>
    <tr>
      <th>2</th>
      <td>the Lake District</td>
      <td>LOC</td>
    </tr>
    <tr>
      <th>3</th>
      <td>North York Moors</td>
      <td>GPE</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Scotland</td>
      <td>GPE</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Helensburgh</td>
      <td>GPE</td>
    </tr>
    <tr>
      <th>7</th>
      <td>south</td>
      <td>LOC</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Central Lowlands</td>
      <td>LOC</td>
    </tr>
    <tr>
      <th>10</th>
      <td>the Southern Uplands</td>
      <td>LOC</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Wales</td>
      <td>GPE</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Northern Ireland</td>
      <td>GPE</td>
    </tr>
    <tr>
      <th>14</th>
      <td>the Mourne Mountains</td>
      <td>LOC</td>
    </tr>
    <tr>
      <th>17</th>
      <td>the Grampian Mountains</td>
      <td>LOC</td>
    </tr>
    <tr>
      <th>19</th>
      <td>the River Severn</td>
      <td>LOC</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>In Python, there are often many ways to achieve the same goal. To use what we have done so far as an example, you can also use the code below to achieve the same (creating the <code class="docutils literal notranslate"><span class="pre">locations</span></code> list). Try it yourself!</p>
<p><code class="docutils literal notranslate"><span class="pre">locations.extend([[entity.text,</span> <span class="pre">entity.label_]</span> <span class="pre">for</span> <span class="pre">entity</span> <span class="pre">in</span> <span class="pre">UK_physicalGeo_doc.ents</span> <span class="pre">if</span> <span class="pre">entity.label_</span> <span class="pre">in</span> <span class="pre">[‘LOC’,</span> <span class="pre">'GPE']]</span></code></p>
<p>After recognizing (or extracting) these place names, we next want to geocode them. First, we want to see how far we can go without using any external geocoding/geoparsing libraries.</p>
<p>As we discussed in the lecture, to do geocoding, we need a gazetteer first. Since the example we are using is mostly about the UK, we can use the <a class="reference external" href="https://gazetteer.org.uk/purchase">Gazetteer of British Place Names</a>. Make sure you downloaded the csv file into your local directory, and remember to replace the directory <code class="docutils literal notranslate"><span class="pre">../../LabData/GBPN_14062021.csv</span></code> below to yours.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>

<span class="n">UK_gazetteer_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../../LabData/GBPN_14062021.csv&#39;</span><span class="p">)</span>
<span class="n">UK_gazetteer_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/var/folders/xg/5n3zc4sn5hlcg8zzz6ysx21m0000gq/T/ipykernel_53963/3736579507.py:4: DtypeWarning: Columns (3) have mixed types. Specify dtype option on import or set low_memory=False.
  UK_gazetteer_df = pd.read_csv(&#39;../../LabData/GBPN_14062021.csv&#39;)
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>GBPNID</th>
      <th>PlaceName</th>
      <th>GridRef</th>
      <th>Lat</th>
      <th>Lng</th>
      <th>HistCounty</th>
      <th>Division</th>
      <th>AdCounty</th>
      <th>District</th>
      <th>UniAuth</th>
      <th>Police</th>
      <th>Region</th>
      <th>Alternative_Names</th>
      <th>Type</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>A' Chill</td>
      <td>NG2705</td>
      <td>57.057719</td>
      <td>-6.500908</td>
      <td>Argyllshire</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Highland</td>
      <td>Highlands and Islands</td>
      <td>Scotland</td>
      <td>NaN</td>
      <td>Settlement</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>Ab Kettleby</td>
      <td>SK7223</td>
      <td>52.800049</td>
      <td>-0.927993</td>
      <td>Leicestershire</td>
      <td>NaN</td>
      <td>Leicestershire</td>
      <td>Melton</td>
      <td>NaN</td>
      <td>Leicestershire</td>
      <td>England</td>
      <td>NaN</td>
      <td>Settlement</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>Ab Lench</td>
      <td>SP0151</td>
      <td>52.163533</td>
      <td>-1.980962</td>
      <td>Worcestershire</td>
      <td>NaN</td>
      <td>Worcestershire</td>
      <td>Wychavon</td>
      <td>NaN</td>
      <td>West Mercia</td>
      <td>England</td>
      <td>NaN</td>
      <td>Settlement</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>Abaty Cwm-hir</td>
      <td>SO0571</td>
      <td>52.331015</td>
      <td>-3.389919</td>
      <td>Radnorshire</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Powys</td>
      <td>Dyfed Powys</td>
      <td>Wales</td>
      <td>Abbey-cwm-hir, Abbeycwmhir</td>
      <td>Settlement</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>Abbey-cwm-hir</td>
      <td>SO0571</td>
      <td>52.331015</td>
      <td>-3.389919</td>
      <td>Radnorshire</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Powys</td>
      <td>Dyfed Powys</td>
      <td>Wales</td>
      <td>Abaty Cwm-hir, Abbeycwmhir</td>
      <td>Settlement</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>This is obiviously a spatial data set as it has two columns <code class="docutils literal notranslate"><span class="pre">Lat</span></code> abd <code class="docutils literal notranslate"><span class="pre">Lng</span></code> that represent the geographic coordinates of the entry. Then, we want to transfer the data as <code class="docutils literal notranslate"><span class="pre">geopandas</span></code>. To do so, we will convert the <code class="docutils literal notranslate"><span class="pre">Lat</span></code> and <code class="docutils literal notranslate"><span class="pre">Lng</span></code> columns into a new column, which is called <code class="docutils literal notranslate"><span class="pre">geometry</span></code>. We also need to assign the right coordinate reference system to the data (we have covered all these in the lectures).</p>
<p>If you started doing so, you will quickly find there might be an error saying something is wrong on the <code class="docutils literal notranslate"><span class="pre">Lat</span></code> column. Don’t be panic! After you understand what the error indicates, you can go back to the csv file, where you will find a cell value on <code class="docutils literal notranslate"><span class="pre">Lat</span></code> is <code class="docutils literal notranslate"><span class="pre">53.20N</span></code>. This is not a standard way of representing geographic coordinates. What we can do is to simply remove that row, then finish the transformation from <code class="docutils literal notranslate"><span class="pre">dataframe</span></code> to <code class="docutils literal notranslate"><span class="pre">geodataframe</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">UK_gazetteer_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">UK_gazetteer_df</span><span class="p">[</span><span class="n">UK_gazetteer_df</span><span class="p">[</span><span class="s1">&#39;Lat&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;53.20N &#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="n">UK_gazetteer_gpd</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span>
   <span class="n">UK_gazetteer_df</span> <span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="n">gpd</span><span class="o">.</span><span class="n">points_from_xy</span><span class="p">(</span><span class="n">UK_gazetteer_df</span><span class="o">.</span><span class="n">Lng</span><span class="p">,</span> <span class="n">UK_gazetteer_df</span><span class="o">.</span><span class="n">Lat</span><span class="p">))</span>
<span class="c1">#UK_gazetteer_gpd.set_crs(&#39;epsg:4326&#39;)</span>
<span class="n">UK_gazetteer_gpd</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>GBPNID</th>
      <th>PlaceName</th>
      <th>GridRef</th>
      <th>Lat</th>
      <th>Lng</th>
      <th>HistCounty</th>
      <th>Division</th>
      <th>AdCounty</th>
      <th>District</th>
      <th>UniAuth</th>
      <th>Police</th>
      <th>Region</th>
      <th>Alternative_Names</th>
      <th>Type</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>A' Chill</td>
      <td>NG2705</td>
      <td>57.057719</td>
      <td>-6.500908</td>
      <td>Argyllshire</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Highland</td>
      <td>Highlands and Islands</td>
      <td>Scotland</td>
      <td>NaN</td>
      <td>Settlement</td>
      <td>POINT (-6.50091 57.05772)</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>Ab Kettleby</td>
      <td>SK7223</td>
      <td>52.800049</td>
      <td>-0.927993</td>
      <td>Leicestershire</td>
      <td>NaN</td>
      <td>Leicestershire</td>
      <td>Melton</td>
      <td>NaN</td>
      <td>Leicestershire</td>
      <td>England</td>
      <td>NaN</td>
      <td>Settlement</td>
      <td>POINT (-0.92799 52.80005)</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>Ab Lench</td>
      <td>SP0151</td>
      <td>52.163533</td>
      <td>-1.980962</td>
      <td>Worcestershire</td>
      <td>NaN</td>
      <td>Worcestershire</td>
      <td>Wychavon</td>
      <td>NaN</td>
      <td>West Mercia</td>
      <td>England</td>
      <td>NaN</td>
      <td>Settlement</td>
      <td>POINT (-1.98096 52.16353)</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>Abaty Cwm-hir</td>
      <td>SO0571</td>
      <td>52.331015</td>
      <td>-3.389919</td>
      <td>Radnorshire</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Powys</td>
      <td>Dyfed Powys</td>
      <td>Wales</td>
      <td>Abbey-cwm-hir, Abbeycwmhir</td>
      <td>Settlement</td>
      <td>POINT (-3.38992 52.33102)</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>Abbey-cwm-hir</td>
      <td>SO0571</td>
      <td>52.331015</td>
      <td>-3.389919</td>
      <td>Radnorshire</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Powys</td>
      <td>Dyfed Powys</td>
      <td>Wales</td>
      <td>Abaty Cwm-hir, Abbeycwmhir</td>
      <td>Settlement</td>
      <td>POINT (-3.38992 52.33102)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Now we have the geoparsed place name list and a gazetteer to extract candidate place names with their coordinates. Let’s now do a lookup matching.</p>
<p>Guess what? We can use the <code class="docutils literal notranslate"><span class="pre">merge()</span></code> (similar to <code class="docutils literal notranslate"><span class="pre">join()</span></code>) operations we learned in Tutoiral 1 to achieve it:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">locations_merged</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">locations_df</span><span class="p">,</span> <span class="n">UK_gazetteer_gpd</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;Place Name&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;PlaceName&#39;</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s2">&quot;left&quot;</span><span class="p">)</span>
<span class="n">locations_merged</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Place Name</th>
      <th>Tag</th>
      <th>GBPNID</th>
      <th>PlaceName</th>
      <th>GridRef</th>
      <th>Lat</th>
      <th>Lng</th>
      <th>HistCounty</th>
      <th>Division</th>
      <th>AdCounty</th>
      <th>District</th>
      <th>UniAuth</th>
      <th>Police</th>
      <th>Region</th>
      <th>Alternative_Names</th>
      <th>Type</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>UK</td>
      <td>GPE</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
    </tr>
    <tr>
      <th>1</th>
      <td>England</td>
      <td>GPE</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
    </tr>
    <tr>
      <th>2</th>
      <td>the Lake District</td>
      <td>LOC</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
    </tr>
    <tr>
      <th>3</th>
      <td>North York Moors</td>
      <td>GPE</td>
      <td>198897.0</td>
      <td>North York Moors</td>
      <td>SE7295</td>
      <td>54.347372</td>
      <td>-0.886344</td>
      <td>Yorkshire</td>
      <td>North Riding</td>
      <td>North Yorkshire</td>
      <td>Ryedale</td>
      <td>NaN</td>
      <td>North Yorkshire</td>
      <td>England</td>
      <td>NaN</td>
      <td>Downs, Moorland</td>
      <td>POINT (-0.88634 54.34737)</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Scotland</td>
      <td>GPE</td>
      <td>39523.0</td>
      <td>Scotland</td>
      <td>SK3822</td>
      <td>52.796412</td>
      <td>-1.428229</td>
      <td>Leicestershire</td>
      <td>NaN</td>
      <td>Leicestershire</td>
      <td>North West Leicestershire</td>
      <td>NaN</td>
      <td>Leicestershire</td>
      <td>England</td>
      <td>NaN</td>
      <td>Settlement</td>
      <td>POINT (-1.42823 52.79641)</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Scotland</td>
      <td>GPE</td>
      <td>39524.0</td>
      <td>Scotland</td>
      <td>SP6798</td>
      <td>52.57925</td>
      <td>-1.000125</td>
      <td>Leicestershire</td>
      <td>NaN</td>
      <td>Leicestershire</td>
      <td>Harborough</td>
      <td>NaN</td>
      <td>Leicestershire</td>
      <td>England</td>
      <td>NaN</td>
      <td>Settlement</td>
      <td>POINT (-1.00012 52.57925)</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Scotland</td>
      <td>GPE</td>
      <td>39525.0</td>
      <td>Scotland</td>
      <td>SU5669</td>
      <td>51.417258</td>
      <td>-1.196096</td>
      <td>Berkshire</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>West Berkshire</td>
      <td>Thames Valley</td>
      <td>England</td>
      <td>NaN</td>
      <td>Settlement</td>
      <td>POINT (-1.19610 51.41726)</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Scotland</td>
      <td>GPE</td>
      <td>39526.0</td>
      <td>Scotland</td>
      <td>TF0030</td>
      <td>52.8604</td>
      <td>-0.512500</td>
      <td>Lincolnshire</td>
      <td>Parts of Kesteven</td>
      <td>Lincolnshire</td>
      <td>South Kesteven</td>
      <td>NaN</td>
      <td>Lincolnshire</td>
      <td>England</td>
      <td>NaN</td>
      <td>Settlement</td>
      <td>POINT (-0.51250 52.86040)</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Scotland</td>
      <td>GPE</td>
      <td>294460.0</td>
      <td>Scotland</td>
      <td>SE2340</td>
      <td>53.857797</td>
      <td>-1.641983</td>
      <td>Yorkshire</td>
      <td>West Riding</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Leeds</td>
      <td>West Yorkshire</td>
      <td>England</td>
      <td>NaN</td>
      <td>Settlement</td>
      <td>POINT (-1.64198 53.85780)</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Helensburgh</td>
      <td>GPE</td>
      <td>21050.0</td>
      <td>Helensburgh</td>
      <td>NS2982</td>
      <td>56.003981</td>
      <td>-4.733445</td>
      <td>Dunbartonshire</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Argyll and Bute</td>
      <td>Argyll and West Dunbartonshire</td>
      <td>Scotland</td>
      <td>Baile Eilidh</td>
      <td>Settlement</td>
      <td>POINT (-4.73344 56.00398)</td>
    </tr>
    <tr>
      <th>10</th>
      <td>south</td>
      <td>LOC</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Central Lowlands</td>
      <td>LOC</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
    </tr>
    <tr>
      <th>12</th>
      <td>the Southern Uplands</td>
      <td>LOC</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Wales</td>
      <td>GPE</td>
      <td>47495.0</td>
      <td>Wales</td>
      <td>SK4782</td>
      <td>53.341077</td>
      <td>-1.284149</td>
      <td>Yorkshire</td>
      <td>West Riding</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Rotherham</td>
      <td>South Yorkshire</td>
      <td>England</td>
      <td>NaN</td>
      <td>Settlement</td>
      <td>POINT (-1.28415 53.34108)</td>
    </tr>
    <tr>
      <th>14</th>
      <td>Wales</td>
      <td>GPE</td>
      <td>47496.0</td>
      <td>Wales</td>
      <td>ST5824</td>
      <td>51.02019</td>
      <td>-2.590189</td>
      <td>Somerset</td>
      <td>NaN</td>
      <td>Somerset</td>
      <td>South Somerset</td>
      <td>NaN</td>
      <td>Avon and Somerset</td>
      <td>England</td>
      <td>NaN</td>
      <td>Settlement</td>
      <td>POINT (-2.59019 51.02019)</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Wales</td>
      <td>GPE</td>
      <td>64525.0</td>
      <td>Wales</td>
      <td>SK4782</td>
      <td>53.341105</td>
      <td>-1.290959</td>
      <td>Yorkshire</td>
      <td>West Riding</td>
      <td>South Yorkshire</td>
      <td>Rotherham</td>
      <td>NaN</td>
      <td>South Yorkshire</td>
      <td>England</td>
      <td>NaN</td>
      <td>Civil Parish</td>
      <td>POINT (-1.29096 53.34110)</td>
    </tr>
    <tr>
      <th>16</th>
      <td>Northern Ireland</td>
      <td>GPE</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
    </tr>
    <tr>
      <th>17</th>
      <td>the Mourne Mountains</td>
      <td>LOC</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
    </tr>
    <tr>
      <th>18</th>
      <td>the Grampian Mountains</td>
      <td>LOC</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
    </tr>
    <tr>
      <th>19</th>
      <td>the River Severn</td>
      <td>LOC</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Alright, as you can see, many place names, such as “North York Moors” and “Helensburgh” are now geocoded. You will also notice some places, like “Wales” and “Scotland” are matched to multiple coordinates. It is because in our gazetteer, there are multiple records about “Wales” and “Scotland”. Note also that these are not the “Wales” and “Scotland” you are thinking. If you check the gazetteer by searching for rows that have <code class="docutils literal notranslate"><span class="pre">Place</span> <span class="pre">Name</span></code> and “Wales” for example (see below), you will find these <code class="docutils literal notranslate"><span class="pre">Wales</span></code> are either “Settlement” and “Civil Parish” in England.</p>
<p>Plus, we also see many place names such as “UK”, “the Lake District”, “Pennines”, etc. do not find a match (their GBPNIDs are all NaN).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">UK_gazetteer_gpd</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">UK_gazetteer_gpd</span><span class="p">[</span><span class="s1">&#39;PlaceName&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Wales&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>GBPNID</th>
      <th>PlaceName</th>
      <th>GridRef</th>
      <th>Lat</th>
      <th>Lng</th>
      <th>HistCounty</th>
      <th>Division</th>
      <th>AdCounty</th>
      <th>District</th>
      <th>UniAuth</th>
      <th>Police</th>
      <th>Region</th>
      <th>Alternative_Names</th>
      <th>Type</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>47317</th>
      <td>47495</td>
      <td>Wales</td>
      <td>SK4782</td>
      <td>53.341077</td>
      <td>-1.284149</td>
      <td>Yorkshire</td>
      <td>West Riding</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Rotherham</td>
      <td>South Yorkshire</td>
      <td>England</td>
      <td>NaN</td>
      <td>Settlement</td>
      <td>POINT (-1.28415 53.34108)</td>
    </tr>
    <tr>
      <th>47318</th>
      <td>47496</td>
      <td>Wales</td>
      <td>ST5824</td>
      <td>51.02019</td>
      <td>-2.590189</td>
      <td>Somerset</td>
      <td>NaN</td>
      <td>Somerset</td>
      <td>South Somerset</td>
      <td>NaN</td>
      <td>Avon and Somerset</td>
      <td>England</td>
      <td>NaN</td>
      <td>Settlement</td>
      <td>POINT (-2.59019 51.02019)</td>
    </tr>
    <tr>
      <th>62356</th>
      <td>64525</td>
      <td>Wales</td>
      <td>SK4782</td>
      <td>53.341105</td>
      <td>-1.290959</td>
      <td>Yorkshire</td>
      <td>West Riding</td>
      <td>South Yorkshire</td>
      <td>Rotherham</td>
      <td>NaN</td>
      <td>South Yorkshire</td>
      <td>England</td>
      <td>NaN</td>
      <td>Civil Parish</td>
      <td>POINT (-1.29096 53.34110)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>All these are due to facts that (1) our imported gazetteer is only about places in England, and (2) our simple model is incapable of capturing the context of the text. Do you have better ideas to improve our simple geocoding tool?</p>
<p>Now it is the right time to introduce you some more “fancy” geocoding/geoparsing libraries. Let’s try <code class="docutils literal notranslate"><span class="pre">spacy_dbpedia_spotlight</span></code> here. Make sure you have installed it. Assuming we already have the <code class="docutils literal notranslate"><span class="pre">nlp</span></code> objec from the previous steps, or you can create a new one like below, below are the code of using the library:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">spacy_dbpedia_spotlight</span>
<span class="kn">import</span> <span class="nn">spacy</span>
<span class="n">nlp</span> <span class="o">=</span> <span class="n">spacy</span><span class="o">.</span><span class="n">blank</span><span class="p">(</span><span class="s1">&#39;en&#39;</span><span class="p">)</span>
<span class="c1"># add the pipeline stage</span>
<span class="n">nlp</span><span class="o">.</span><span class="n">add_pipe</span><span class="p">(</span><span class="s1">&#39;dbpedia_spotlight&#39;</span><span class="p">)</span>
<span class="c1"># get the document</span>
<span class="n">doc</span> <span class="o">=</span> <span class="n">nlp</span><span class="p">(</span><span class="n">UK_physicalGeo</span><span class="p">)</span>
<span class="c1"># see the entities</span>
<span class="n">entities_dbpedia</span> <span class="o">=</span> <span class="p">[(</span><span class="n">ent</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">ent</span><span class="o">.</span><span class="n">label_</span><span class="p">,</span> <span class="n">ent</span><span class="o">.</span><span class="n">kb_id_</span><span class="p">,</span> <span class="n">ent</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">dbpedia_raw_result</span><span class="p">[</span><span class="s1">&#39;@similarityScore&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">ent</span> <span class="ow">in</span> <span class="n">doc</span><span class="o">.</span><span class="n">ents</span><span class="p">]</span>
<span class="n">entities_dbpedia</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&#39;UK&#39;,
 &#39;DBPEDIA_ENT&#39;,
 &#39;http://dbpedia.org/resource/United_Kingdom&#39;,
 &#39;0.9999999697674871&#39;)
</pre></div>
</div>
</div>
</div>
<p>What the code does is to go through all the tokens in the text and try to find the corresponding entities from DBpedia. The result is a list of tuples. One tuple example is as shown in the box. It includes the text that is parsed, its label (notice how different it is than <code class="docutils literal notranslate"><span class="pre">spaCy</span></code>’s labels), its id in DBpedia (this is very useful as all associated information can be further retrieved using this link. We will cover more about it in future lectures (and tutorials), and a score from 0-1 (this is the similarity score of the string matching; the higher it is, the more similar the target text with the candidate).</p>
<p>Similar to what we did before, we can then transfer this list into a <code class="docutils literal notranslate"><span class="pre">dataframe</span></code>. Note that since we do not have coordinates explicitly listed here, we can simply use <code class="docutils literal notranslate"><span class="pre">pandas</span></code>’s general <code class="docutils literal notranslate"><span class="pre">dataframe</span></code>.</p>
<p>Check <a class="reference external" href="https://github.com/MartinoMensio/spacy-dbpedia-spotlight">Spacy DBpedia Spotlight</a> for more interesting functions and examples.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Text&#39;</span><span class="p">,</span> <span class="s1">&#39;DBpedia Label&#39;</span><span class="p">,</span> <span class="s1">&#39;DBpedia URI&#39;</span><span class="p">,</span> <span class="s1">&#39;Similarity Score&#39;</span><span class="p">]</span>

<span class="n">UK_physicalGeo_DBpedia</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">entities_dbpedia</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
<span class="n">UK_physicalGeo_DBpedia</span> <span class="o">=</span> <span class="n">UK_physicalGeo_DBpedia</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
<span class="n">UK_physicalGeo_DBpedia</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Text</th>
      <th>DBpedia Label</th>
      <th>DBpedia URI</th>
      <th>Similarity Score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>physical geography</td>
      <td>DBPEDIA_ENT</td>
      <td>http://dbpedia.org/resource/Physical_geography</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>UK</td>
      <td>DBPEDIA_ENT</td>
      <td>http://dbpedia.org/resource/United_Kingdom</td>
      <td>0.9999999697674871</td>
    </tr>
    <tr>
      <th>2</th>
      <td>England</td>
      <td>DBPEDIA_ENT</td>
      <td>http://dbpedia.org/resource/England</td>
      <td>0.9999997958868998</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Lake District</td>
      <td>DBPEDIA_ENT</td>
      <td>http://dbpedia.org/resource/Lake_District</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Moors</td>
      <td>DBPEDIA_ENT</td>
      <td>http://dbpedia.org/resource/Moorland</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Exmoor</td>
      <td>DBPEDIA_ENT</td>
      <td>http://dbpedia.org/resource/Exmoor</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Dartmoor</td>
      <td>DBPEDIA_ENT</td>
      <td>http://dbpedia.org/resource/Dartmoor</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>chalk</td>
      <td>DBPEDIA_ENT</td>
      <td>http://dbpedia.org/resource/Chalk</td>
      <td>0.999982297417919</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Scotland</td>
      <td>DBPEDIA_ENT</td>
      <td>http://dbpedia.org/resource/Scotland</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Highland Boundary Fault</td>
      <td>DBPEDIA_ENT</td>
      <td>http://dbpedia.org/resource/Highland_Boundary_...</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>12</th>
      <td>Scottish</td>
      <td>DBPEDIA_ENT</td>
      <td>http://dbpedia.org/resource/Scotland</td>
      <td>0.9997720847861457</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Helensburgh</td>
      <td>DBPEDIA_ENT</td>
      <td>http://dbpedia.org/resource/Helensburgh</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>14</th>
      <td>Stonehaven</td>
      <td>DBPEDIA_ENT</td>
      <td>http://dbpedia.org/resource/Stonehaven</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>15</th>
      <td>faultline</td>
      <td>DBPEDIA_ENT</td>
      <td>http://dbpedia.org/resource/Faultline_(musician)</td>
      <td>0.9838808091555019</td>
    </tr>
    <tr>
      <th>17</th>
      <td>Central Lowlands</td>
      <td>DBPEDIA_ENT</td>
      <td>http://dbpedia.org/resource/Central_Lowlands</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>18</th>
      <td>Southern Uplands</td>
      <td>DBPEDIA_ENT</td>
      <td>http://dbpedia.org/resource/Southern_Uplands</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>19</th>
      <td>Wales</td>
      <td>DBPEDIA_ENT</td>
      <td>http://dbpedia.org/resource/Wales</td>
      <td>0.9999999999998863</td>
    </tr>
    <tr>
      <th>22</th>
      <td>Northern Ireland</td>
      <td>DBPEDIA_ENT</td>
      <td>http://dbpedia.org/resource/Northern_Ireland</td>
      <td>0.999999996766519</td>
    </tr>
    <tr>
      <th>23</th>
      <td>geography</td>
      <td>DBPEDIA_ENT</td>
      <td>http://dbpedia.org/resource/Geography</td>
      <td>0.9947401620497708</td>
    </tr>
    <tr>
      <th>24</th>
      <td>Mourne Mountains</td>
      <td>DBPEDIA_ENT</td>
      <td>http://dbpedia.org/resource/Mourne_Mountains</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>25</th>
      <td>Lough Neagh</td>
      <td>DBPEDIA_ENT</td>
      <td>http://dbpedia.org/resource/Lough_Neagh</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>26</th>
      <td>geomorphology</td>
      <td>DBPEDIA_ENT</td>
      <td>http://dbpedia.org/resource/Geomorphology</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>28</th>
      <td>climate change</td>
      <td>DBPEDIA_ENT</td>
      <td>http://dbpedia.org/resource/Global_warming</td>
      <td>0.9859722723298184</td>
    </tr>
    <tr>
      <th>29</th>
      <td>glaciation</td>
      <td>DBPEDIA_ENT</td>
      <td>http://dbpedia.org/resource/Glacial_period</td>
      <td>0.9861545121455497</td>
    </tr>
    <tr>
      <th>31</th>
      <td>British Isles</td>
      <td>DBPEDIA_ENT</td>
      <td>http://dbpedia.org/resource/British_Isles</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>32</th>
      <td>Nevis</td>
      <td>DBPEDIA_ENT</td>
      <td>http://dbpedia.org/resource/River_Nevis</td>
      <td>0.9999978752268652</td>
    </tr>
    <tr>
      <th>33</th>
      <td>Grampian Mountains</td>
      <td>DBPEDIA_ENT</td>
      <td>http://dbpedia.org/resource/Grampian_Mountains</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>35</th>
      <td>River Severn</td>
      <td>DBPEDIA_ENT</td>
      <td>http://dbpedia.org/resource/River_Severn</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>38</th>
      <td>lake</td>
      <td>DBPEDIA_ENT</td>
      <td>http://dbpedia.org/resource/Lake</td>
      <td>0.999999999890747</td>
    </tr>
    <tr>
      <th>42</th>
      <td>Loch Ness</td>
      <td>DBPEDIA_ENT</td>
      <td>http://dbpedia.org/resource/Loch_Ness</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>It seems that the coordinate is not extracted from the tool. But if you use the url, for example <a class="reference external" href="https://dbpedia.org/page/Lake_District">https://dbpedia.org/page/Lake_District</a>, you will see a full information about the place, including its geometry and more! See below for instance:
<img alt="DBpedia-Point" src="../_images/lab2-fig5.png" /></p>
<p>If you wish to extract the geometry of the identified geographic entities automatically in python, below is the example function. Here we used a library <code class="docutils literal notranslate"><span class="pre">SPARQLWrapper</span></code> for us to send a SPARQL query (or called a request) to an endpoint (or called server, here we use DBpedia <code class="docutils literal notranslate"><span class="pre">http://dbpedia.org/sparql</span></code> as an example), and the endpoint will respond by sending the queried information back to your python program.</p>
<p>Also note that the process is exactly same to using SQL query language. The only difference is that SQL is for tabular data, while SPARQL is for knowledge graphs, which we will discuss in the near future. To learn SQL in Python, I suggest <a class="reference external" href="https://www.datacamp.com/tutorial/tutorial-how-to-execute-sql-queries-in-r-and-python">this post</a>, in which I recommend to check the use <a class="reference external" href="https://docs.python.org/3/library/sqlite3.html">sqlite3</a> library.</p>
<p>The syntax of SQL and SPARQl are quite similar. Main reasons to focus on SPARQL here are:
(1) SPARQL is more advanced
(2) Many knowledge graphs are open, so that we can readily access the endpoint. In contrast, we must first build some relational databases (using MySQL, Postgres, etc.) in order to use SQL in Python</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">SPARQLWrapper</span> <span class="kn">import</span> <span class="n">SPARQLWrapper</span><span class="p">,</span> <span class="n">JSON</span>

<span class="k">def</span> <span class="nf">get_coordinates</span><span class="p">(</span><span class="n">place_url</span><span class="p">):</span>
    
    <span class="n">sparql</span> <span class="o">=</span> <span class="n">SPARQLWrapper</span><span class="p">(</span><span class="s2">&quot;http://dbpedia.org/sparql&quot;</span><span class="p">)</span>
    <span class="n">sparql</span><span class="o">.</span><span class="n">setReturnFormat</span><span class="p">(</span><span class="n">JSON</span><span class="p">)</span>
    
    <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;PREFIX db: &lt;http://dbpedia.org/resource/&gt;</span>
<span class="s2">    PREFIX georss: &lt;http://www.georss.org/georss/&gt;</span>
<span class="s2">    SELECT ?geom WHERE { &lt;</span><span class="si">%s</span><span class="s2">&gt; georss:point ?geom. } &quot;&quot;&quot;</span><span class="o">%</span><span class="k">place_url</span>

    <span class="n">sparql</span><span class="o">.</span><span class="n">setQuery</span><span class="p">(</span><span class="n">query</span><span class="p">)</span> 
    <span class="k">return</span> <span class="n">sparql</span><span class="o">.</span><span class="n">query</span><span class="p">()</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span>

<span class="n">example</span> <span class="o">=</span> <span class="n">get_coordinates</span><span class="p">(</span><span class="s2">&quot;http://dbpedia.org/resource/Dartmoor&quot;</span><span class="p">)</span>
<span class="n">example</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;head&#39;: {&#39;link&#39;: [], &#39;vars&#39;: [&#39;geom&#39;]},
 &#39;results&#39;: {&#39;distinct&#39;: False,
  &#39;ordered&#39;: True,
  &#39;bindings&#39;: [{&#39;geom&#39;: {&#39;type&#39;: &#39;literal&#39;,
     &#39;value&#39;: &#39;50.56666666666667 -4.0&#39;}}]}}
</pre></div>
</div>
</div>
</div>
<p>The result <code class="docutils literal notranslate"><span class="pre">example</span></code> is formated as json (check <a class="reference external" href="https://www.w3schools.com/js/js_json_intro.asp">this documentation</a> if you have not heard about it). We can easily extract the attribute <code class="docutils literal notranslate"><span class="pre">geom</span></code> from it:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">geom</span> <span class="o">=</span> <span class="n">example</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">][</span><span class="s1">&#39;bindings&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;geom&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
<span class="n">geom</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;50.56666666666667 -4.0&#39;
</pre></div>
</div>
</div>
</div>
<p>Finally, even thgough <code class="docutils literal notranslate"><span class="pre">spacy_dbpedia_spotlight</span></code> has its advantages for geoparsing, there are still flaws in such a tool. For example, many non-spatial entiteis are also detected and coordinates are not explicitly show (e.g., Moors). Do you have any idea on addressing these issues? (hint: maybe check this library - <a class="reference external" href="https://github.com/MatteusT/pyDBpedia">pyDBpedia</a> which also helps you access the data shown in DBpedia).</p>
<p>Now, you can also try to use it on your extracted tweets, or other texts you get from the Internet.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "ox"
        },
        kernelOptions: {
            name: "ox",
            path: "./labs"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'ox'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="lab01.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Lab 01: Dealing with Spatial Data in Python</p>
      </div>
    </a>
    <a class="right-next"
       href="lab03.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Lab 03: Indexing and Relevance Ranking on Geo-Texts</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#part-1-1-retrieving-data-from-location-based-social-media">Part 1-1: Retrieving data from location-based social media</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#part-1-2-extracting-geo-text-from-twitter">Part 1-2: Extracting (geo)text from Twitter</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#part-2-basic-natural-language-processing-and-geoparsing">Part 2: Basic Natural Language Processing and Geoparsing</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#part-3-geocoding-the-recognized-place-names">Part 3: Geocoding the recognized place names</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Dr. Rui Zhu
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>