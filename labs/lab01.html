

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Lab 01: Dealing with Spatial Data in Python &#8212; GEOGM0068: Geographic Information Retrieval and Integration</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'labs/lab01';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Lab 02: Georefereing Location-based Social Media" href="lab02.html" />
    <link rel="prev" title="Lecture 10: Ethics, Summary, and Career" href="../lectures/lecture10.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/unit-logo2.png" class="logo__image only-light" alt="GEOGM0068: Geographic Information Retrieval and Integration - Home"/>
    <script>document.write(`<img src="../_static/unit-logo2.png" class="logo__image only-dark" alt="GEOGM0068: Geographic Information Retrieval and Integration - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Welcome to GEOGM0068: Geographic Information Retrieval and Integration
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Lecture</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../lectures/lecture01.html">Lecture 01: Introduction and Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lectures/lecture02.html">Lecture 02: Spatial Database I</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lectures/lecture03.html">Lecture 03: Spatial Database II</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lectures/lecture04.html">Lecture 04: Georeferencing I</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lectures/lecture05.html">Lecture 05: Georeferencing II</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lectures/lecture06.html">Lecture 06: Spatial Indexing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lectures/lecture07.html">Lecture 07: Spatial Ranking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lectures/lecture08.html">Lecture 08: Geospatial Semantics I</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lectures/lecture09.html">Lecture 09: Geospatial Semantics II</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lectures/lecture10.html">Lecture 10: Ethics, Summary, and Career</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Lab</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Lab 01: Dealing with Spatial Data in Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab02.html">Lab 02: Georefereing Location-based Social Media</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab03.html">Lab 03: Indexing and Relevance Ranking on Geo-Texts</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab04.html">Lab 04: Neural Network Embedding for Places</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/zhurui0509/GEOGM0068-git" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/zhurui0509/GEOGM0068-git/issues/new?title=Issue%20on%20page%20%2Flabs/lab01.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/labs/lab01.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Lab 01: Dealing with Spatial Data in Python</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#basics-in-pandas-for-non-spatial-data">Basics in Pandas (for non-spatial data)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#create-a-dataframe-from-scratch">Create a dataframe from scratch</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-data">Loading data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#viewing-your-data">Viewing your data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#querying-selecting-slicing-extracting-dataframe">Querying (selecting, slicing, extracting) Dataframe</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#select-by-column">Select by column</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#select-by-row">Select by row</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#conditional-selection">Conditional selection</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#geopandas-for-spatial-data">GeoPandas for Spatial Data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-spatial-data">Loading spatial data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#saving-spatial-data">Saving spatial data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#retrieving-data-directly-from-osm">Retrieving data directly from OSM</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#coordinate-reference-system-for-geodataframe">Coordinate Reference System for GeoDataFrame</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#computation-on-geodataframe">Computation on GeoDataFrame</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#spatial-join">Spatial join</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualization">Visualization</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="lab-01-dealing-with-spatial-data-in-python">
<h1>Lab 01: Dealing with Spatial Data in Python<a class="headerlink" href="#lab-01-dealing-with-spatial-data-in-python" title="Permalink to this heading">#</a></h1>
<p>In this tutorial, we will work on dealing with non-spatial and spatial data using Python libraries: pandas and geopandas. Many concepts/techniques will be echoed to the ones you have learned from <a class="reference internal" href="../lectures/lecture02.html#lecture02"><span class="std std-ref">Lecture 02: Spatial Database I</span></a> and <a class="reference internal" href="../lectures/lecture03.html#lecture03"><span class="std std-ref">Lecture 03: Spatial Database II</span></a>.</p>
<p>To follow this tutorial, you should have installed <a class="reference external" href="https://jupyter.org/install">Jupyter Notebook</a> (or Jupyter Lab) on your own computer (note: computers in the lab should have already installed it).</p>
<p>Requred packages include:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://pandas.pydata.org/docs/getting_started/install.html">pandas</a> / <a class="reference external" href="https://geopandas.org/en/stable/getting_started/install.html">geopandas</a></p></li>
<li><p><a class="reference external" href="https://pypi.org/project/Shapely/">shapely</a></p></li>
<li><p><a class="reference external" href="https://pysal.org/docs/install/">pysal</a></p></li>
<li><p><a class="reference external" href="https://pypi.org/project/pyproj/">pyproj</a></p></li>
<li><p><a class="reference external" href="https://osmnx.readthedocs.io/en/stable/">osmnx</a> / <a class="reference external" href="https://pyrosm.readthedocs.io/en/latest/installation.html">pyrosm</a></p></li>
<li><p><a class="reference external" href="https://pypi.org/project/matplotlib/">matplotlib</a> (visualization)</p></li>
</ul>
<p>Mostly, you can use the commond like <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">pandas</span></code> to install the package.</p>
<section id="basics-in-pandas-for-non-spatial-data">
<h2>Basics in Pandas (for non-spatial data)<a class="headerlink" href="#basics-in-pandas-for-non-spatial-data" title="Permalink to this heading">#</a></h2>
<p>Pandas is currently the mostly important tool for data scientists working in Python. It is the backbone of many state-of-the-art techniques like machine learning and visualization. Here we cover the basics of using Pandas. For more comprehensive tutorial, follow <a class="reference external" href="https://www.youtube.com/watch?v=5rNu16O3YNE">this video</a> and/or <a class="reference external" href="https://www.learndatasci.com/tutorials/python-pandas-tutorial-complete-introduction-for-beginners/">this post</a></p>
<p>First of all, the two key components in Pandas are <code class="docutils literal notranslate"><span class="pre">Series</span></code> and <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>. A <code class="docutils literal notranslate"><span class="pre">Series</span></code> is essentially a column, and a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> is a multi-dimensional table made up of a collection of <code class="docutils literal notranslate"><span class="pre">Series</span></code>. These two components are quite similar in that many operations that you can do with one, you can do with the other too, such as filling in null values and calculating the mean.</p>
<p><img alt="Series and DataFrame" src="../_images/lab1-fig1.png" /></p>
<section id="create-a-dataframe-from-scratch">
<h3>Create a dataframe from scratch<a class="headerlink" href="#create-a-dataframe-from-scratch" title="Permalink to this heading">#</a></h3>
<p>There are many ways to create a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> from scratch, but a great option is to just use a simple <code class="docutils literal notranslate"><span class="pre">dict</span></code> (this is a common data structure called dictionary, which is composed by a <code class="docutils literal notranslate"><span class="pre">key:value</span></code> pair). Each <code class="docutils literal notranslate"><span class="pre">key:value</span></code> pair corresponds to a column in the resulting <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>.</p>
<p>Let’s say we have a fruit stand that sells apples and oranges. We want to have a column for each fruit and a row for each customer purchase. To organize this as a dictionary for pandas we could do something like:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;apples&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> 
    <span class="s1">&#39;oranges&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="p">}</span>
<span class="n">purchases</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">purchases</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/var/folders/xg/5n3zc4sn5hlcg8zzz6ysx21m0000gq/T/ipykernel_83912/2875102215.py:1: DeprecationWarning: 
Pyarrow will become a required dependency of pandas in the next major release of pandas (pandas 3.0),
(to allow more performant data types, such as the Arrow string type, and better interoperability with other libraries)
but was not found to be installed on your system.
If this would cause problems for you,
please provide us feedback at https://github.com/pandas-dev/pandas/issues/54466
        
  import pandas as pd
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>apples</th>
      <th>oranges</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>3</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>7</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The Index of this DataFrame was given to us as the numbers 0-3. We could also create our own when we initialize the DataFrame.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">purchases</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;June&#39;</span><span class="p">,</span> <span class="s1">&#39;Robert&#39;</span><span class="p">,</span> <span class="s1">&#39;Lily&#39;</span><span class="p">,</span> <span class="s1">&#39;David&#39;</span><span class="p">])</span>
<span class="n">purchases</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>apples</th>
      <th>oranges</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>June</th>
      <td>3</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Robert</th>
      <td>2</td>
      <td>3</td>
    </tr>
    <tr>
      <th>Lily</th>
      <td>0</td>
      <td>7</td>
    </tr>
    <tr>
      <th>David</th>
      <td>1</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>So now we could locate a customer’s order by using their name:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">purchases</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;June&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>apples     3
oranges    0
Name: June, dtype: int64
</pre></div>
</div>
</div>
</div>
</section>
<section id="loading-data">
<h3>Loading data<a class="headerlink" href="#loading-data" title="Permalink to this heading">#</a></h3>
<p>We can also load in data with formats like <code class="docutils literal notranslate"><span class="pre">csv</span></code>, <code class="docutils literal notranslate"><span class="pre">json</span></code>, <code class="docutils literal notranslate"><span class="pre">txt</span></code>, and so on. For example, if you downloaded <code class="docutils literal notranslate"><span class="pre">purchase.csv</span></code> to your local directory, you should be able to load the data by running:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">purchases_loaded</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;purchase.csv&#39;</span><span class="p">)</span>
<span class="n">purchases_loaded</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Unnamed:0</th>
      <th>apples</th>
      <th>oranges</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>June</td>
      <td>3</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Robert</td>
      <td>2</td>
      <td>3</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Lily</td>
      <td>0</td>
      <td>7</td>
    </tr>
    <tr>
      <th>3</th>
      <td>David</td>
      <td>1</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Note here that CSVs don’t have indexes like DataFrames, so we need to designate the <code class="docutils literal notranslate"><span class="pre">index_col</span></code> when reading:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">purchases_loaded</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;purchase.csv&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">purchases_loaded</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>apples</th>
      <th>oranges</th>
    </tr>
    <tr>
      <th>Unnamed:0</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>June</th>
      <td>3</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Robert</th>
      <td>2</td>
      <td>3</td>
    </tr>
    <tr>
      <th>Lily</th>
      <td>0</td>
      <td>7</td>
    </tr>
    <tr>
      <th>David</th>
      <td>1</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="viewing-your-data">
<h3>Viewing your data<a class="headerlink" href="#viewing-your-data" title="Permalink to this heading">#</a></h3>
<p>There are many operations to view/describe your data. For example, you can use <code class="docutils literal notranslate"><span class="pre">.head()</span></code> to check the first several rows of your dataframe, <code class="docutils literal notranslate"><span class="pre">.tail()</span></code> to see the last severl rows, <code class="docutils literal notranslate"><span class="pre">.info()</span></code> to have a list of information about your dataframe (you are suggested to always run it first after your data is loaded), <code class="docutils literal notranslate"><span class="pre">.shape</span></code> to see the dimension of your dataframe (i.e., how many rows and columns are there?), etc. Let’s try <code class="docutils literal notranslate"><span class="pre">.info()</span></code> here and you could also try the others yourself.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">purchases_loaded</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Index: 4 entries, June to David
Data columns (total 2 columns):
 #   Column   Non-Null Count  Dtype
---  ------   --------------  -----
 0   apples   4 non-null      int64
 1   oranges  4 non-null      int64
dtypes: int64(2)
memory usage: 96.0+ bytes
</pre></div>
</div>
</div>
</div>
<p>From the output, you can see our loaded <code class="docutils literal notranslate"><span class="pre">purchases_loaded</span></code> dataframe has 4 entries (rows), and there are two columnes, each has 4 non-null values and their data types are both int64 (i.e., integer with 64 digits). Data type here is an important concept (we have covered it in our lecture too). Different data types might imply various operations/analysis that are available. See the table below for a full list of data types in Pandas, and Python and NumPy (another important package in Python).</p>
<p><img alt="dtype_pandas" src="../_images/lab1-fig2.png" /></p>
</section>
<section id="querying-selecting-slicing-extracting-dataframe">
<h3>Querying (selecting, slicing, extracting) Dataframe<a class="headerlink" href="#querying-selecting-slicing-extracting-dataframe" title="Permalink to this heading">#</a></h3>
<p>Similar to the complex DBMS, Pandas also support selecting, slicing or extracting data from the <code class="docutils literal notranslate"><span class="pre">Dataframe</span></code>.</p>
<section id="select-by-column">
<h4>Select by column<a class="headerlink" href="#select-by-column" title="Permalink to this heading">#</a></h4>
<p>We can extract a column using square brackets like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">purchases_apple</span> <span class="o">=</span> <span class="n">purchases_loaded</span><span class="p">[</span><span class="s1">&#39;apples&#39;</span><span class="p">]</span>
<span class="n">purchases_apple</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Unnamed:0
June       3
Robert     2
Lily       0
David      1
Name: apples, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">purchases_apple</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>pandas.core.series.Series
</pre></div>
</div>
</div>
</div>
<p>Notice that the returned <code class="docutils literal notranslate"><span class="pre">purchases_apple</span></code> is a <code class="docutils literal notranslate"><span class="pre">Series</span></code>. To extract a column as a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>, we need to pass a list of column names. In our case that’s just a single column of “apples”, but is within a double bracket:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">purchases_apple</span> <span class="o">=</span> <span class="n">purchases_loaded</span><span class="p">[[</span><span class="s1">&#39;apples&#39;</span><span class="p">]]</span>
<span class="nb">type</span><span class="p">(</span><span class="n">purchases_apple</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>pandas.core.frame.DataFrame
</pre></div>
</div>
</div>
</div>
</section>
<section id="select-by-row">
<h4>Select by row<a class="headerlink" href="#select-by-row" title="Permalink to this heading">#</a></h4>
<p>For rows, we can use two ways to extract data:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">loc</span></code>: locates by name</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">iloc</span></code>: locates by numerical index</p></li>
</ul>
<p>For example, we can select the row of June (how many apples and oranges June has got?) from our <code class="docutils literal notranslate"><span class="pre">purchase_loaded</span></code> dataframe.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">purchases_June</span> <span class="o">=</span> <span class="n">purchases_loaded</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;June&quot;</span><span class="p">]</span>
<span class="n">purchases_June</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>apples     3
oranges    0
Name: June, dtype: int64
</pre></div>
</div>
</div>
</div>
</section>
<section id="conditional-selection">
<h4>Conditional selection<a class="headerlink" href="#conditional-selection" title="Permalink to this heading">#</a></h4>
<p>So far, We’ve gone over how to select columns and rows, but what if we want to make a conditional selection?</p>
<p>For example, what if we want to filter our <code class="docutils literal notranslate"><span class="pre">purchases_loaded</span></code> DataFrame to show only people who bought apples less than 2?</p>
<p>To do that, we take a column from the DataFrame and apply a Boolean condition to it. Here’s an example of a Boolean condition:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">condition</span> <span class="o">=</span> <span class="p">(</span><span class="n">purchases_loaded</span><span class="p">[</span><span class="s1">&#39;apples&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">condition</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Unnamed:0
June       False
Robert     False
Lily        True
David       True
Name: apples, dtype: bool
</pre></div>
</div>
</div>
</div>
<p>A little bit more complex, how about showing people who bought apples less than 2 but oranges larger than 2? Can you try it? Hint, you need to use the logic operator <code class="docutils literal notranslate"><span class="pre">&amp;</span></code> to connect two conditions.</p>
</section>
</section>
</section>
<section id="geopandas-for-spatial-data">
<h2>GeoPandas for Spatial Data<a class="headerlink" href="#geopandas-for-spatial-data" title="Permalink to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">Geopandas</span></code> is designed to process spatial data in Python. <code class="docutils literal notranslate"><span class="pre">Geopandas</span></code> combines the capabilities of data processing library <code class="docutils literal notranslate"><span class="pre">pandas</span></code> with other packages like <code class="docutils literal notranslate"><span class="pre">shapely</span></code> and <code class="docutils literal notranslate"><span class="pre">fiona</span></code> for managing and visualizing spatial data. The main data structures in geopandas are <code class="docutils literal notranslate"><span class="pre">GeoSeries</span></code> and <code class="docutils literal notranslate"><span class="pre">GeoDataFrame</span></code> which extend the capabilities of <code class="docutils literal notranslate"><span class="pre">Series</span></code> and <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> from <code class="docutils literal notranslate"><span class="pre">pandas</span></code>, but with spatial speciality.</p>
<p>The key difference between <code class="docutils literal notranslate"><span class="pre">GeoDataFrame</span></code> and <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> is that a <code class="docutils literal notranslate"><span class="pre">GeoDataFrame</span></code> contains at least one column as geometry so that the data entry is spatially referenced. By default, the name of this column is <code class="docutils literal notranslate"><span class="pre">'geometry'</span></code>. The geometry column is a <code class="docutils literal notranslate"><span class="pre">GeoSeries</span></code> which contains the geometries (points, lines, polygons, multipolygons etc.) as <code class="docutils literal notranslate"><span class="pre">shapely</span></code> objects.</p>
<section id="loading-spatial-data">
<h3>Loading spatial data<a class="headerlink" href="#loading-spatial-data" title="Permalink to this heading">#</a></h3>
<p>Spatial data that are in the format of <code class="docutils literal notranslate"><span class="pre">geojson</span></code>, <code class="docutils literal notranslate"><span class="pre">shp</span></code>, etc. can all be loaded as GeoPandas’ Dataframe (<code class="docutils literal notranslate"><span class="pre">GeoDataFrame</span></code>) by using the function <code class="docutils literal notranslate"><span class="pre">read_file()</span></code>. Let’s use a shapefile (<code class="docutils literal notranslate"><span class="pre">shp</span></code>) downloaded from <a class="reference external" href="http://download.geofabrik.de/">OpenStreetMap</a> as an example here. You can also find the specific data (building in Bristol) from Blackboard.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>

<span class="c1"># Filepath</span>
<span class="n">bristol_building_file</span> <span class="o">=</span> <span class="s2">&quot;./bristol-buildings.shp/gis_osm_buildings_a_free_1.shp&quot;</span> <span class="c1"># make sure the directory is correct in your case</span>

<span class="c1"># Read the file</span>
<span class="n">bristol_building</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">bristol_building_file</span><span class="p">)</span>

<span class="c1"># How does it look?</span>
<span class="n">bristol_building</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>osm_id</th>
      <th>code</th>
      <th>fclass</th>
      <th>name</th>
      <th>type</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>4309554</td>
      <td>1500</td>
      <td>building</td>
      <td>Bristol City Hall</td>
      <td>None</td>
      <td>POLYGON ((-2.60242 51.45242, -2.60241 51.45244...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4315318</td>
      <td>1500</td>
      <td>building</td>
      <td>Clifton Cathedral</td>
      <td>church</td>
      <td>POLYGON ((-2.61673 51.45965, -2.61673 51.45965...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4315809</td>
      <td>1500</td>
      <td>building</td>
      <td>Clifton Down Shopping Centre</td>
      <td>retail</td>
      <td>POLYGON ((-2.61133 51.46431, -2.61070 51.46441...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4317900</td>
      <td>1500</td>
      <td>building</td>
      <td>Za Za Bazaar</td>
      <td>None</td>
      <td>POLYGON ((-2.59869 51.45029, -2.59865 51.45042...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4317901</td>
      <td>1500</td>
      <td>building</td>
      <td>Mackenzies Café Bar</td>
      <td>commercial</td>
      <td>POLYGON ((-2.59851 51.45107, -2.59850 51.45110...</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>As can be seen here, the <code class="docutils literal notranslate"><span class="pre">GeoDataFrame</span></code> <code class="docutils literal notranslate"><span class="pre">bristol_building</span></code> contains various attributes in separate columns. The <code class="docutils literal notranslate"><span class="pre">geometry</span></code> column contains the spatial information (it is <a class="reference external" href="https://en.wikipedia.org/wiki/Well-known_text_representation_of_geometry">WKT format</a>, which is implemented by the <code class="docutils literal notranslate"><span class="pre">shapely</span></code> library). We can next take a look of the basic information of <code class="docutils literal notranslate"><span class="pre">bristol_building</span></code> using the following command:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bristol_building</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;geopandas.geodataframe.GeoDataFrame&#39;&gt;
RangeIndex: 149805 entries, 0 to 149804
Data columns (total 6 columns):
 #   Column    Non-Null Count   Dtype   
---  ------    --------------   -----   
 0   osm_id    149805 non-null  object  
 1   code      149805 non-null  int64   
 2   fclass    149805 non-null  object  
 3   name      7587 non-null    object  
 4   type      98915 non-null   object  
 5   geometry  149805 non-null  geometry
dtypes: geometry(1), int64(1), object(4)
memory usage: 6.9+ MB
</pre></div>
</div>
</div>
</div>
<p>What kind of information can you get from this output?</p>
<p>Since our data is intrinsically spatial (it has a <code class="docutils literal notranslate"><span class="pre">geometry</span></code> column), we can visualize it to better understand its spatial distribution. <code class="docutils literal notranslate"><span class="pre">plot()</span></code> is the function for it:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bristol_building</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: &gt;
</pre></div>
</div>
<img alt="../_images/f2413d24c42e2d81d1cc727cb441ef05b9229100d9e2be0eea45b5b94f36bd5c.png" src="../_images/f2413d24c42e2d81d1cc727cb441ef05b9229100d9e2be0eea45b5b94f36bd5c.png" />
</div>
</div>
</section>
<section id="saving-spatial-data">
<h3>Saving spatial data<a class="headerlink" href="#saving-spatial-data" title="Permalink to this heading">#</a></h3>
<p>Once you are done with your process/analysis, you can also save your <code class="docutils literal notranslate"><span class="pre">GeoDataFrame</span></code> into files (e.g., <code class="docutils literal notranslate"><span class="pre">.shp</span></code>, <code class="docutils literal notranslate"><span class="pre">.geojson</span></code>, etc). Here, since we loaded data from <code class="docutils literal notranslate"><span class="pre">.shp</span></code>, let’s now try to save our data to <code class="docutils literal notranslate"><span class="pre">.geojson</span></code> (in the example below, we only save a subset of <code class="docutils literal notranslate"><span class="pre">bristol_building</span></code>):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bristol_building</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">100</span><span class="p">]</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="s1">&#39;osm_bristol_buildings.geojson&#39;</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="s1">&#39;GeoJSON&#39;</span><span class="p">)</span> 
<span class="c1">## this will save your data to the current directory same to this notebook. </span>
<span class="c1">## you can check the current directory by ruing cwd = os.getcwd()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="retrieving-data-directly-from-osm">
<h3>Retrieving data directly from OSM<a class="headerlink" href="#retrieving-data-directly-from-osm" title="Permalink to this heading">#</a></h3>
<p>We have so far seen how to read spatial data from your computer disk (i.e., the data is downloaded and saved on your local directory). Next, let’s see how we can retrieve data from OSM directly using a library called <code class="docutils literal notranslate"><span class="pre">pyrosm</span></code>. With <code class="docutils literal notranslate"><span class="pre">pyrosm</span></code>, you can easily retrieve data from anywhere in the world based on <code class="docutils literal notranslate"><span class="pre">OSM.PBF</span></code> files (a specific data format for OSM) that are distributed by <a class="reference external" href="http://download.geofabrik.de/">Geofabrik</a>. In fact, this is where the Bristol buildings data were downloaded. The package aims to be a more efficient way to parse OSM data covering large geographical areas (such as countries and cities).</p>
<p>Note that if you would like to be flexible about your download, e.g., selecting a bounding box by yourself rather than by administrative regions, you can consider using <a class="reference external" href="https://osmnx.readthedocs.io/en/stable/"><code class="docutils literal notranslate"><span class="pre">OSMnx</span></code></a> library.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyrosm</span> <span class="kn">import</span> <span class="n">OSM</span><span class="p">,</span> <span class="n">get_data</span><span class="c1"># Download data for Bristol</span>

<span class="n">bristol</span> <span class="o">=</span> <span class="n">get_data</span><span class="p">(</span><span class="s2">&quot;bristol&quot;</span><span class="p">)</span>

<span class="c1"># Initialize the reader object for Bristol</span>
<span class="n">osm</span> <span class="o">=</span> <span class="n">OSM</span><span class="p">(</span><span class="n">bristol</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>In the first command, we downloaded the data for “Bristol” using the <code class="docutils literal notranslate"><span class="pre">get_data</span></code> function. This function in fact automates the data downloading process and stores the data locally in a temporary folder. The next step was to initialize a reader object called <code class="docutils literal notranslate"><span class="pre">osm</span></code>. The <code class="docutils literal notranslate"><span class="pre">OSM()</span></code> function takes the filepath of a given osm.pbf file as an input. Notice that at this point we actually haven’t yet read any data into a <code class="docutils literal notranslate"><span class="pre">GeoDataFrame</span></code>.</p>
<p>OSM contains a lot of information about the world, which is contributed by citizens like you and me. In principle, we can retrieve information under various themes from OSM using the following functions.</p>
<ul class="simple">
<li><p>road networks –&gt; <code class="docutils literal notranslate"><span class="pre">osm.get_network()</span></code></p></li>
<li><p>buildings –&gt; <code class="docutils literal notranslate"><span class="pre">osm.get_buildings()</span></code></p></li>
<li><p>Points of Interest (POI) –&gt; <code class="docutils literal notranslate"><span class="pre">osm.get_pois()</span></code></p></li>
<li><p>landuse –&gt; <code class="docutils literal notranslate"><span class="pre">osm.get_landuse()</span></code></p></li>
<li><p>natural elements –&gt; <code class="docutils literal notranslate"><span class="pre">osm.get_natural()</span></code></p></li>
<li><p>boundaries –&gt; <code class="docutils literal notranslate"><span class="pre">osm.get_boundaries()</span></code></p></li>
</ul>
<p>Try them yourselves! You might consider using them in your dissertation project too. Here, let’s extract the road network at Bristol from OSM:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bristol_roadnetwork</span> <span class="o">=</span> <span class="n">osm</span><span class="o">.</span><span class="n">get_network</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/gy22808/opt/anaconda3/envs/ox/lib/python3.12/site-packages/pyrosm/networks.py:37: FutureWarning: ChainedAssignmentError: behaviour will change in pandas 3.0!
You are setting values through chained assignment. Currently this works in certain cases, but when using Copy-on-Write (which will become the default behaviour in pandas 3.0) this will never work to update the original DataFrame or Series, because the intermediate object on which we are setting values will behave as a copy.
A typical example is when you are setting values in a column of a DataFrame, like:

df[&quot;col&quot;][row_indexer] = value

Use `df.loc[row_indexer, &quot;col&quot;] = values` instead, to perform the assignment in a single step and ensure this keeps updating the original `df`.

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy

  edges, nodes = prepare_geodataframe(
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyboardInterrupt</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">17</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">bristol_roadnetwork</span> <span class="o">=</span> <span class="n">osm</span><span class="o">.</span><span class="n">get_network</span><span class="p">()</span>

<span class="nn">File ~/opt/anaconda3/envs/ox/lib/python3.12/site-packages/pyrosm/pyrosm.py:249,</span> in <span class="ni">OSM.get_network</span><span class="nt">(self, network_type, extra_attributes, nodes, timestamp)</span>
<span class="g g-Whitespace">    </span><span class="mi">246</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_pbf</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">248</span> <span class="c1"># Filter network data with given filter</span>
<span class="ne">--&gt; </span><span class="mi">249</span> <span class="n">edges</span><span class="p">,</span> <span class="n">node_gdf</span> <span class="o">=</span> <span class="n">get_network_data</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">250</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_node_coordinates</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">251</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_way_records</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">252</span>     <span class="n">tags_as_columns</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">253</span>     <span class="n">network_filter</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">254</span>     <span class="bp">self</span><span class="o">.</span><span class="n">bounding_box</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">255</span>     <span class="n">slice_to_segments</span><span class="o">=</span><span class="n">nodes</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">256</span> <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">258</span> <span class="k">if</span> <span class="n">edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">259</span>     <span class="c1"># Add metadata</span>
<span class="g g-Whitespace">    </span><span class="mi">260</span>     <span class="n">edges</span><span class="o">.</span><span class="n">_metadata</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">network_type</span><span class="p">)</span>

<span class="nn">File ~/opt/anaconda3/envs/ox/lib/python3.12/site-packages/pyrosm/networks.py:37,</span> in <span class="ni">get_network_data</span><span class="nt">(node_coordinates, way_records, tags_as_columns, network_filter, bounding_box, slice_to_segments)</span>
<span class="g g-Whitespace">     </span><span class="mi">34</span>     <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
<span class="g g-Whitespace">     </span><span class="mi">36</span> <span class="c1"># Prepare GeoDataFrame</span>
<span class="ne">---&gt; </span><span class="mi">37</span> <span class="n">edges</span><span class="p">,</span> <span class="n">nodes</span> <span class="o">=</span> <span class="n">prepare_geodataframe</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">38</span>     <span class="n">nodes</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">39</span>     <span class="n">node_coordinates</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">40</span>     <span class="n">ways</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">41</span>     <span class="n">relations</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">42</span>     <span class="n">relation_ways</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">43</span>     <span class="n">tags_as_columns</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">44</span>     <span class="n">bounding_box</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">45</span>     <span class="n">parse_network</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">46</span>     <span class="n">calculate_seg_lengths</span><span class="o">=</span><span class="n">slice_to_segments</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">47</span> <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">49</span> <span class="k">return</span> <span class="n">edges</span><span class="p">,</span> <span class="n">nodes</span>

<span class="nn">File ~/opt/anaconda3/envs/ox/lib/python3.12/site-packages/pyrosm/frames.pyx:136,</span> in <span class="ni">pyrosm.frames.prepare_geodataframe</span><span class="nt">()</span>

<span class="nn">File ~/opt/anaconda3/envs/ox/lib/python3.12/site-packages/pyrosm/frames.pyx:143,</span> in <span class="ni">pyrosm.frames.prepare_geodataframe</span><span class="nt">()</span>

<span class="nn">File ~/opt/anaconda3/envs/ox/lib/python3.12/site-packages/pyrosm/frames.pyx:72,</span> in <span class="ni">pyrosm.frames.prepare_way_gdf</span><span class="nt">()</span>

<span class="nn">File ~/opt/anaconda3/envs/ox/lib/python3.12/site-packages/pyrosm/distance.py:78,</span> in <span class="ni">calculate_geom_length</span><span class="nt">(geom)</span>
<span class="g g-Whitespace">     </span><span class="mi">77</span> <span class="k">def</span> <span class="nf">calculate_geom_length</span><span class="p">(</span><span class="n">geom</span><span class="p">):</span>
<span class="ne">---&gt; </span><span class="mi">78</span>     <span class="k">return</span> <span class="n">calculate_geom_array_length</span><span class="p">(</span><span class="n">geom</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="nn">File ~/opt/anaconda3/envs/ox/lib/python3.12/site-packages/pyrosm/distance.py:82,</span> in <span class="ni">calculate_geom_array_length</span><span class="nt">(geom_array)</span>
<span class="g g-Whitespace">     </span><span class="mi">81</span> <span class="k">def</span> <span class="nf">calculate_geom_array_length</span><span class="p">(</span><span class="n">geom_array</span><span class="p">):</span>
<span class="ne">---&gt; </span><span class="mi">82</span>     <span class="n">coords</span> <span class="o">=</span> <span class="n">get_coordinates</span><span class="p">(</span><span class="n">geom_array</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="g g-Whitespace">     </span><span class="mi">84</span>     <span class="c1"># Only every second element should be taken from the coordinates</span>
<span class="g g-Whitespace">     </span><span class="mi">85</span>     <span class="n">lon1</span><span class="p">,</span> <span class="n">lat1</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>

<span class="nn">File ~/opt/anaconda3/envs/ox/lib/python3.12/site-packages/shapely/coordinates.py:136,</span> in <span class="ni">get_coordinates</span><span class="nt">(geometry, include_z, return_index)</span>
<span class="g g-Whitespace">     </span><span class="mi">93</span> <span class="k">def</span> <span class="nf">get_coordinates</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="n">include_z</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">return_index</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="g g-Whitespace">     </span><span class="mi">94</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;Gets coordinates from a geometry array as an array of floats.</span>
<span class="g g-Whitespace">     </span><span class="mi">95</span><span class="sd"> </span>
<span class="g g-Whitespace">     </span><span class="mi">96</span><span class="sd">     The shape of the returned array is (N, 2), with N being the number of</span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">    </span><span class="mi">134</span><span class="sd">     ([[2.0, 2.0], [4.0, 4.0], [0.0, 0.0]], [0, 0, 1])</span>
<span class="g g-Whitespace">    </span><span class="mi">135</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">136</span>     <span class="k">return</span> <span class="n">lib</span><span class="o">.</span><span class="n">get_coordinates</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">137</span>         <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">object_</span><span class="p">),</span> <span class="n">include_z</span><span class="p">,</span> <span class="n">return_index</span>
<span class="g g-Whitespace">    </span><span class="mi">138</span>     <span class="p">)</span>

<span class="ne">KeyboardInterrupt</span>: 
</pre></div>
</div>
</div>
</div>
<p>We can get the lenth of this DataFrame (how many road network do we have in Bristol from OSM?) and some basic descritions of it by running:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">bristol_roadnetwork</span><span class="p">)</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>102212
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bristol_roadnetwork</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span> <span class="c1"># note that it only provides a statistical summary for columns whoes data type is numeric</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>timestamp</th>
      <th>version</th>
      <th>length</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>1.022120e+05</td>
      <td>102212.0</td>
      <td>102212.0</td>
      <td>102212.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>4.555495e+08</td>
      <td>0.0</td>
      <td>-1.0</td>
      <td>108.314650</td>
    </tr>
    <tr>
      <th>std</th>
      <td>3.824359e+08</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>193.418633</td>
    </tr>
    <tr>
      <th>min</th>
      <td>1.900000e+02</td>
      <td>0.0</td>
      <td>-1.0</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>8.795292e+07</td>
      <td>0.0</td>
      <td>-1.0</td>
      <td>20.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>3.684994e+08</td>
      <td>0.0</td>
      <td>-1.0</td>
      <td>48.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>7.817397e+08</td>
      <td>0.0</td>
      <td>-1.0</td>
      <td>111.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>1.245598e+09</td>
      <td>0.0</td>
      <td>-1.0</td>
      <td>7572.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Likewise, we can also plot it. Please try it yourself.</p>
</section>
<section id="coordinate-reference-system-for-geodataframe">
<h3>Coordinate Reference System for GeoDataFrame<a class="headerlink" href="#coordinate-reference-system-for-geodataframe" title="Permalink to this heading">#</a></h3>
<p>Another difference between <code class="docutils literal notranslate"><span class="pre">GeoDataFrames</span></code> and <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code> is that the former has intrinsic coordinate reference system (CRS) as it has the <code class="docutils literal notranslate"><span class="pre">geometry</span></code> column. To check this information, we can call its attribute <code class="docutils literal notranslate"><span class="pre">crs</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bristol_roadnetwork</span><span class="o">.</span><span class="n">crs</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Geographic 2D CRS: EPSG:4326&gt;
Name: WGS 84
Axis Info [ellipsoidal]:
- Lat[north]: Geodetic latitude (degree)
- Lon[east]: Geodetic longitude (degree)
Area of Use:
- name: World.
- bounds: (-180.0, -90.0, 180.0, 90.0)
Datum: World Geodetic System 1984 ensemble
- Ellipsoid: WGS 84
- Prime Meridian: Greenwich
</pre></div>
</div>
</div>
</div>
<p>It shows that coordinates in <code class="docutils literal notranslate"><span class="pre">geometry</span></code> column are using the WGS 84 with a EPSG code 4326. In fact, it is the mostly used coordinate reference system (CRS) in spatial data science as it is a global coordinate system and has been used for GPS as well. However, as we covered in the lecture, those global CRSs are not that accurate for local regions. For the UK, or Bristol, a more commonly used CRS is EPSG:27700 (National Grid for Great Britain), and this CRS is also projected. Let’s then transfer <code class="docutils literal notranslate"><span class="pre">bristol_roadnetwork</span></code> from EPSG:4326 to EPSG:27700:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bristol_roadnetwork_reprojected</span> <span class="o">=</span> <span class="n">bristol_roadnetwork</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">27700</span><span class="p">)</span>
<span class="n">bristol_roadnetwork_reprojected</span><span class="o">.</span><span class="n">crs</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Projected CRS: EPSG:27700&gt;
Name: OSGB36 / British National Grid
Axis Info [cartesian]:
- E[east]: Easting (metre)
- N[north]: Northing (metre)
Area of Use:
- name: United Kingdom (UK) - offshore to boundary of UKCS within 49°45&#39;N to 61°N and 9°W to 2°E; onshore Great Britain (England, Wales and Scotland). Isle of Man onshore.
- bounds: (-9.01, 49.75, 2.01, 61.01)
Coordinate Operation:
- name: British National Grid
- method: Transverse Mercator
Datum: Ordnance Survey of Great Britain 1936
- Ellipsoid: Airy 1830
- Prime Meridian: Greenwich
</pre></div>
</div>
</div>
</div>
<p>Now we have an projected CRS for the road network data in Bristol. To confirm the difference, let’s take a look at the geometry of the first row in our original road network <code class="docutils literal notranslate"><span class="pre">bristol_roadnetwork</span></code> and the projected <code class="docutils literal notranslate"><span class="pre">bristol_roadnetwork_reprojected</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">orig_geom</span> <span class="o">=</span> <span class="n">bristol_roadnetwork</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;geometry&quot;</span><span class="p">]</span>
<span class="n">projected_geom</span> <span class="o">=</span> <span class="n">bristol_roadnetwork_reprojected</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;geometry&quot;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Orig:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">orig_geom</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Proj:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">projected_geom</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Orig:
 MULTILINESTRING ((-2.6097211837768555 51.3657112121582, -2.609546422958374 51.36564636230469), (-2.609546422958374 51.36564636230469, -2.609264612197876 51.365482330322266), (-2.609264612197876 51.365482330322266, -2.6088733673095703 51.365318298339844), (-2.6088733673095703 51.365318298339844, -2.608508825302124 51.36508560180664), (-2.608508825302124 51.36508560180664, -2.6083426475524902 51.3649787902832), (-2.6083426475524902 51.3649787902832, -2.608126163482666 51.364810943603516), (-2.608126163482666 51.364810943603516, -2.607820749282837 51.36458206176758)) 

Proj:
 MULTILINESTRING ((357648.974429959 163137.70370458602, 357661.0804417359 163130.39013390895), (357661.0804417359 163130.39013390895, 357680.5471925497 163111.98427999223), (357680.5471925497 163111.98427999223, 357707.6323758529 163093.51498389826), (357707.6323758529 163093.51498389826, 357732.79552590376 163067.42507962266), (357732.79552590376 163067.42507962266, 357744.2656479743 163055.45009858347), (357744.2656479743 163055.45009858347, 357759.1817168629 163036.65820931632), (357759.1817168629 163036.65820931632, 357780.23268873093 163011.0270668068))
</pre></div>
</div>
</div>
</div>
<p>As we be seen, the coordinates that form our road segments (MULTILINESTRING) has changed from <code class="docutils literal notranslate"><span class="pre">decimal</span> <span class="pre">degrees</span></code> to <code class="docutils literal notranslate"><span class="pre">meters</span></code>. Next, let’s visualize it:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">orig_geom</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/49644894b983545672944919fd63489d2809182b8e0f0685a70f25c123bfa2bc.svg" src="../_images/49644894b983545672944919fd63489d2809182b8e0f0685a70f25c123bfa2bc.svg" /></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">projected_geom</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/b8e23c4440a34129d85e504efe15607a51662e609a1ca9e13a516f02df9dd646.svg" src="../_images/b8e23c4440a34129d85e504efe15607a51662e609a1ca9e13a516f02df9dd646.svg" /></div>
</div>
<p>As you can see, the shape of the two road segments are quite different (e.g., the lenth, where the curve occures, etc.). This is exactly due to the difference between the two CRSs.</p>
<p>It is also worth noting here, the data type, MultiLineString, of the variables <code class="docutils literal notranslate"><span class="pre">orig_geom</span></code> and <code class="docutils literal notranslate"><span class="pre">projected_geom</span></code> are defined by <code class="docutils literal notranslate"><span class="pre">shapely</span></code>. It enables us to conduct these kind of spatial operations and visializations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">orig_geom</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>shapely.geometry.multilinestring.MultiLineString
</pre></div>
</div>
</div>
</div>
</section>
<section id="computation-on-geodataframe">
<h3>Computation on GeoDataFrame<a class="headerlink" href="#computation-on-geodataframe" title="Permalink to this heading">#</a></h3>
<p>There are many operations embeded in GeoDataFrame that can be directly called to do some spatial computations. For example, we can get the area of buildings for our <code class="docutils literal notranslate"><span class="pre">bristol_building</span></code> dataframe:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bristol_building</span><span class="p">[</span><span class="s2">&quot;building_area&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bristol_building</span><span class="o">.</span><span class="n">area</span>
<span class="n">bristol_building</span><span class="p">[</span><span class="s2">&quot;building_area&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/var/folders/xg/5n3zc4sn5hlcg8zzz6ysx21m0000gq/T/ipykernel_11376/2251981216.py:1: UserWarning: Geometry is in a geographic CRS. Results from &#39;area&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  bristol_building[&quot;building_area&quot;] = bristol_building.area
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>count    1.498050e+05
mean     1.341308e-08
std      6.657677e-08
min      5.667000e-11
25%      6.084315e-09
50%      7.575225e-09
75%      1.033238e-08
max      1.038017e-05
Name: building_area, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>Here, you can see a warning that the current Geometry is in a geographic CRS, hence the results of computing area mighht not be accurate. Can you project the dataframe to a projected coordicate reference system (e.g.,EPSG:27700 in our case)? After your projection, do the area computation again. What do the results look like? What is the unit of the area?</p>
</section>
<section id="spatial-join">
<h3>Spatial join<a class="headerlink" href="#spatial-join" title="Permalink to this heading">#</a></h3>
<p>As we have discussed in the lecture, joining tables using keys is a core operation for DBMS. Regarding spatial data, spatial join is somewhat similar to table join but with the operation being based on geometries rather than keys.</p>
<p>In this tutorial, we will try to conduct a spatial join and merge information between two <code class="docutils literal notranslate"><span class="pre">GeoDataFrames</span></code>. First, let’s read all restaurants (a type of Point of Interests (POI)) at Bristol from the OSM. Then, we combine information from restaurants to the underlying building (restaurants typically are within buildings). We will again use <code class="docutils literal notranslate"><span class="pre">pyrosm</span></code> for reading the data, but this time we will use the <code class="docutils literal notranslate"><span class="pre">get_pois()</span></code> function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Read Points of Interest (POI) using the same OSM reader object that was initialized earlier</span>
<span class="c1"># The custom_filter={&quot;amenity&quot;: [&quot;restaurant&quot;]} indicates that we want only &quot;restaurant&quot;, a type of POI</span>
<span class="n">bristol_restaurants</span> <span class="o">=</span> <span class="n">osm</span><span class="o">.</span><span class="n">get_pois</span><span class="p">(</span><span class="n">custom_filter</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;amenity&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;restaurant&quot;</span><span class="p">]})</span>
<span class="n">bristol_restaurants</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: &gt;
</pre></div>
</div>
<img alt="../_images/4fb72d58722a4a9de5bb16daa79988cedf3348ae52a02af8e034452904e04efc.png" src="../_images/4fb72d58722a4a9de5bb16daa79988cedf3348ae52a02af8e034452904e04efc.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bristol_restaurants</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;geopandas.geodataframe.GeoDataFrame&#39;&gt;
RangeIndex: 677 entries, 0 to 676
Data columns (total 31 columns):
 #   Column            Non-Null Count  Dtype   
---  ------            --------------  -----   
 0   id                677 non-null    int64   
 1   timestamp         677 non-null    uint32  
 2   tags              640 non-null    object  
 3   changeset         143 non-null    float64 
 4   lon               142 non-null    float32 
 5   version           677 non-null    int32   
 6   visible           676 non-null    object  
 7   lat               142 non-null    float32 
 8   addr:city         501 non-null    object  
 9   addr:country      53 non-null     object  
 10  addr:housenumber  488 non-null    object  
 11  addr:housename    101 non-null    object  
 12  addr:postcode     620 non-null    object  
 13  addr:place        27 non-null     object  
 14  addr:street       583 non-null    object  
 15  email             29 non-null     object  
 16  name              672 non-null    object  
 17  opening_hours     103 non-null    object  
 18  operator          14 non-null     object  
 19  phone             107 non-null    object  
 20  website           258 non-null    object  
 21  amenity           677 non-null    object  
 22  bar               4 non-null      object  
 23  internet_access   10 non-null     object  
 24  source            20 non-null     object  
 25  geometry          677 non-null    geometry
 26  osm_type          677 non-null    object  
 27  building          524 non-null    object  
 28  building:levels   75 non-null     object  
 29  start_date        3 non-null      object  
 30  wikipedia         3 non-null      object  
dtypes: float32(2), float64(1), geometry(1), int32(1), int64(1), object(24), uint32(1)
memory usage: 153.5+ KB
</pre></div>
</div>
</div>
</div>
<p>From the <code class="docutils literal notranslate"><span class="pre">info()</span></code>, we can see that there are 676 restaurants in Bristol according to OSM (you might see a different number depending on which version of OSM data you have downloaded). Note that OSM is a valunteered geographic information platform. So the quality, accuracy, and completness of the data might be low.
Next, let’s join data from <code class="docutils literal notranslate"><span class="pre">bristol_buildings</span></code> to  bristol_restaurants<code class="docutils literal notranslate"><span class="pre">using</span></code>sjoin()` function from geopandas:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Join information from buildings to restaurants</span>
<span class="n">bristol_join</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">sjoin</span><span class="p">(</span><span class="n">bristol_restaurants</span><span class="p">,</span> <span class="n">bristol_building</span><span class="p">)</span>

<span class="c1"># Print column names</span>
<span class="nb">print</span><span class="p">(</span><span class="n">bristol_join</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

<span class="c1"># Show rows</span>
<span class="n">bristol_join</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;id&#39;, &#39;timestamp&#39;, &#39;tags&#39;, &#39;changeset&#39;, &#39;lon&#39;, &#39;version&#39;, &#39;visible&#39;,
       &#39;lat&#39;, &#39;addr:city&#39;, &#39;addr:country&#39;, &#39;addr:housenumber&#39;,
       &#39;addr:housename&#39;, &#39;addr:postcode&#39;, &#39;addr:place&#39;, &#39;addr:street&#39;, &#39;email&#39;,
       &#39;name_left&#39;, &#39;opening_hours&#39;, &#39;operator&#39;, &#39;phone&#39;, &#39;website&#39;, &#39;amenity&#39;,
       &#39;bar&#39;, &#39;internet_access&#39;, &#39;source&#39;, &#39;geometry&#39;, &#39;osm_type&#39;, &#39;building&#39;,
       &#39;building:levels&#39;, &#39;start_date&#39;, &#39;wikipedia&#39;, &#39;index_right&#39;, &#39;osm_id&#39;,
       &#39;code&#39;, &#39;fclass&#39;, &#39;name_right&#39;, &#39;type&#39;, &#39;building_area&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>timestamp</th>
      <th>tags</th>
      <th>changeset</th>
      <th>lon</th>
      <th>version</th>
      <th>visible</th>
      <th>lat</th>
      <th>addr:city</th>
      <th>addr:country</th>
      <th>...</th>
      <th>building:levels</th>
      <th>start_date</th>
      <th>wikipedia</th>
      <th>index_right</th>
      <th>osm_id</th>
      <th>code</th>
      <th>fclass</th>
      <th>name_right</th>
      <th>type</th>
      <th>building_area</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>8</th>
      <td>853556896</td>
      <td>0</td>
      <td>None</td>
      <td>0.0</td>
      <td>-2.611020</td>
      <td>0</td>
      <td>False</td>
      <td>51.458733</td>
      <td>None</td>
      <td>None</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>24609</td>
      <td>451622999</td>
      <td>1500</td>
      <td>building</td>
      <td>The Clifton</td>
      <td>None</td>
      <td>9.942395e-09</td>
    </tr>
    <tr>
      <th>10</th>
      <td>1207448023</td>
      <td>0</td>
      <td>None</td>
      <td>0.0</td>
      <td>-2.625203</td>
      <td>0</td>
      <td>False</td>
      <td>51.453415</td>
      <td>None</td>
      <td>None</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1164</td>
      <td>104679655</td>
      <td>1500</td>
      <td>building</td>
      <td>Avon Gorge Hotel</td>
      <td>hotel</td>
      <td>8.777610e-08</td>
    </tr>
    <tr>
      <th>12</th>
      <td>1386051923</td>
      <td>0</td>
      <td>None</td>
      <td>0.0</td>
      <td>-2.619858</td>
      <td>0</td>
      <td>False</td>
      <td>51.455570</td>
      <td>Bristol</td>
      <td>None</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>23228</td>
      <td>444980827</td>
      <td>1500</td>
      <td>building</td>
      <td>Rodney Hotel</td>
      <td>None</td>
      <td>2.753519e-08</td>
    </tr>
    <tr>
      <th>17</th>
      <td>1881624837</td>
      <td>0</td>
      <td>{"cuisine":"regional","outdoor_seating":"yes",...</td>
      <td>0.0</td>
      <td>-2.585233</td>
      <td>0</td>
      <td>False</td>
      <td>51.451546</td>
      <td>Bristol</td>
      <td>None</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>2138</td>
      <td>125956114</td>
      <td>1500</td>
      <td>building</td>
      <td>Hilton Garden Inn Bristol City Centre</td>
      <td>None</td>
      <td>1.725836e-07</td>
    </tr>
    <tr>
      <th>21</th>
      <td>2900424207</td>
      <td>0</td>
      <td>{"cuisine":"pizza"}</td>
      <td>0.0</td>
      <td>-2.589893</td>
      <td>0</td>
      <td>False</td>
      <td>51.456440</td>
      <td>None</td>
      <td>None</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1945</td>
      <td>124113904</td>
      <td>1500</td>
      <td>building</td>
      <td>The Galleries</td>
      <td>None</td>
      <td>6.674781e-07</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>671</th>
      <td>1069613264</td>
      <td>0</td>
      <td>{"house":"terraced"}</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>-1</td>
      <td>False</td>
      <td>NaN</td>
      <td>Bristol</td>
      <td>None</td>
      <td>...</td>
      <td>2</td>
      <td>None</td>
      <td>None</td>
      <td>145381</td>
      <td>1069613265</td>
      <td>1500</td>
      <td>building</td>
      <td>None</td>
      <td>house</td>
      <td>5.491100e-09</td>
    </tr>
    <tr>
      <th>671</th>
      <td>1069613264</td>
      <td>0</td>
      <td>{"house":"terraced"}</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>-1</td>
      <td>False</td>
      <td>NaN</td>
      <td>Bristol</td>
      <td>None</td>
      <td>...</td>
      <td>2</td>
      <td>None</td>
      <td>None</td>
      <td>145380</td>
      <td>1069613264</td>
      <td>1500</td>
      <td>building</td>
      <td>None</td>
      <td>house</td>
      <td>6.423220e-09</td>
    </tr>
    <tr>
      <th>674</th>
      <td>1188184241</td>
      <td>0</td>
      <td>{"addr:suburb":"Clifton","fhrs:id":"1584632"}</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>-1</td>
      <td>False</td>
      <td>NaN</td>
      <td>Bristol</td>
      <td>None</td>
      <td>...</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>10652</td>
      <td>275376189</td>
      <td>1500</td>
      <td>building</td>
      <td>Ruby &amp; White</td>
      <td>None</td>
      <td>1.343296e-08</td>
    </tr>
    <tr>
      <th>674</th>
      <td>1188184241</td>
      <td>0</td>
      <td>{"addr:suburb":"Clifton","fhrs:id":"1584632"}</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>-1</td>
      <td>False</td>
      <td>NaN</td>
      <td>Bristol</td>
      <td>None</td>
      <td>...</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>10640</td>
      <td>275376177</td>
      <td>1500</td>
      <td>building</td>
      <td>Everyman</td>
      <td>None</td>
      <td>1.508399e-07</td>
    </tr>
    <tr>
      <th>676</th>
      <td>13571356292</td>
      <td>0</td>
      <td>{"addr:suburb":"Clifton","cuisine":"indian","f...</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>-1</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Bristol</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>138593</td>
      <td>13450709</td>
      <td>1500</td>
      <td>building</td>
      <td>The Mint Room</td>
      <td>None</td>
      <td>1.037321e-08</td>
    </tr>
  </tbody>
</table>
<p>862 rows × 38 columns</p>
</div></div></div>
</div>
<p>Now with this joined table, you can check which building each restaurant is locatd in. Note that after joining information from the buildings to restaurants, geometries of the left-side <code class="docutils literal notranslate"><span class="pre">GeoDataFrame</span></code>, i.e. restaurants, were kept by as the default geometries. So if we plot <code class="docutils literal notranslate"><span class="pre">bristol_join</span></code>, you will only see restaurants, rather than buildings + restaurant. Please try!</p>
<p>Also by default, <code class="docutils literal notranslate"><span class="pre">sjoin()</span></code> use the topological relation - intersects. You can also specify this parameter as other types of topological relatoons (e.g., contains and within) in the function. More details can be found at: <a class="reference external" href="https://geopandas.org/en/stable/docs/reference/api/geopandas.sjoin.html">https://geopandas.org/en/stable/docs/reference/api/geopandas.sjoin.html</a></p>
</section>
<section id="visualization">
<h3>Visualization<a class="headerlink" href="#visualization" title="Permalink to this heading">#</a></h3>
<p>So far, we simply used the <code class="docutils literal notranslate"><span class="pre">plot()</span></code> function to visualize <code class="docutils literal notranslate"><span class="pre">GeoDataFrame</span></code>. These maps are less appealing compared to the ones generated via GIS softwares. In fact, the package: <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code> is very powerful in providing us beautiful visualization in Python. Let’s try it.</p>
<p>First, let’s add some legends to the <code class="docutils literal notranslate"><span class="pre">bristol_building</span></code> data using its building type:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">bristol_building</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;RdYlBu&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">12</span><span class="p">),</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/76baecf1e398b8d24fe40babf2b8caf11952eddfb145bdc7a708da7dfd8d83a8.png" src="../_images/76baecf1e398b8d24fe40babf2b8caf11952eddfb145bdc7a708da7dfd8d83a8.png" />
</div>
</div>
<p>Here, we used the parameter <code class="docutils literal notranslate"><span class="pre">column</span></code> to specify the attribute that is used to specify the color for each building (it can be categorical or continuous). We then used <code class="docutils literal notranslate"><span class="pre">cmap</span></code> to specify the colormap for the categories and we added the legend by specifying <code class="docutils literal notranslate"><span class="pre">legend=True</span></code>. Note that since the type of buildings for Bristol is very diverse, we see a long list of legend. There are ways to make it into two columns, for example. Can you explore how to achieve it? Feel free to use Google search!</p>
<p>Another issue is that the map is in a very large map scale. Next, we would like to zoom in a little bit. To do so, we can use <code class="docutils literal notranslate"><span class="pre">set_xlim()</span></code> and <code class="docutils literal notranslate"><span class="pre">set_ylim()</span></code> functions:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Zoom into city center by specifying X and Y coordinate extent</span>
<span class="c1"># These values should be given in the units that our data is presented (here decimal degrees)</span>
<span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.65</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.55</span>
<span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="mf">51.44</span><span class="p">,</span> <span class="mf">51.48</span>

<span class="c1"># Plot the map again</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">bristol_building</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;RdYlBu&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">12</span><span class="p">),</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
 

<span class="c1"># Control and set the x and y limits for the axis</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(51.44, 51.48)
</pre></div>
</div>
<img alt="../_images/960fadaac49e19bd132f080f7537a3db02651aa3a76555319d1fcd7e027b74cb.png" src="../_images/960fadaac49e19bd132f080f7537a3db02651aa3a76555319d1fcd7e027b74cb.png" />
</div>
</div>
<p>As you can see, we now zoomed in to the city center quite a lot. You can adjust the parameters yourself and test more!</p>
<p>Meanwhile, you may wonder whether we can overlay multiple <code class="docutils literal notranslate"><span class="pre">dataframes</span></code> into the map? The answer is yes. Here is a sample code:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Zoom into city center by specifying X and Y coordinate extent</span>
<span class="c1"># These values should be given in the units that our data is presented (here decimal degrees)</span>
<span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.65</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.55</span>
<span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="mf">51.44</span><span class="p">,</span> <span class="mf">51.48</span>

<span class="c1"># Plot the map again</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">bristol_building</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;RdYlBu&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">12</span><span class="p">),</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Plot the roads into the same axis</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">bristol_roadnetwork</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>

<span class="c1"># Control and set the x and y limits for the axis</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(51.44, 51.48)
</pre></div>
</div>
<img alt="../_images/a77c70f95883e52e1115fbe1223e19a0be0b1bc75c95618abecbaaa6e181e08d.png" src="../_images/a77c70f95883e52e1115fbe1223e19a0be0b1bc75c95618abecbaaa6e181e08d.png" />
</div>
</div>
<p>Congrats! You have now finished the very first lab of using Python to process spatial data. I hope you enjoyed it and have seen the power of GeoPandas, and Python in general, for processing and studying spatial data. It is also worth highlighting that the functions introduced in this tutorial are selective. There are way more interesting and useful functions provided by these aforementioned packages. I highly recommended you to explore them by yourself. Learning never stops!</p>
<p>Finally, let’s go back to the task of asking you to figure out how to better organize the long legend box. Below is the solution I found. There might be other ways of doing it. How is yours?</p>
<p>Basically, I used the parameter <code class="docutils literal notranslate"><span class="pre">legend_kwds</span></code> to set up the number of columns (<code class="docutils literal notranslate"><span class="pre">ncol</span></code>) to be <code class="docutils literal notranslate"><span class="pre">4</span></code>. For more details, check its <a class="reference external" href="https://geopandas.org/en/stable/docs/reference/api/geopandas.GeoDataFrame.plot.html">official documentation</a>. Note that knowing how to read these kinds of documentations would be very helpful for your programming, so it is an important skill/experience you should develop.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="kn">import</span> <span class="n">make_axes_locatable</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.65</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.55</span>
<span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="mf">51.44</span><span class="p">,</span> <span class="mf">51.48</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>


<span class="n">bristol_building</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;type&#39;</span><span class="p">,</span>
                <span class="n">categorical</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;RdYlBu&quot;</span><span class="p">,</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> 
                <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">legend_kwds</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;loc&#39;</span><span class="p">:</span> <span class="s1">&#39;lower left&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;ncol&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
                             <span class="s1">&#39;bbox_to_anchor&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)})</span>
<span class="c1">#ax.set_axis_off()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/a458a0b012495b3690ffe50d709afe86479d8d2044c26bdd3a14d9e55adb9e8a.png" src="../_images/a458a0b012495b3690ffe50d709afe86479d8d2044c26bdd3a14d9e55adb9e8a.png" />
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "ox"
        },
        kernelOptions: {
            name: "ox",
            path: "./labs"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'ox'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../lectures/lecture10.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Lecture 10: Ethics, Summary, and Career</p>
      </div>
    </a>
    <a class="right-next"
       href="lab02.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Lab 02: Georefereing Location-based Social Media</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#basics-in-pandas-for-non-spatial-data">Basics in Pandas (for non-spatial data)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#create-a-dataframe-from-scratch">Create a dataframe from scratch</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-data">Loading data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#viewing-your-data">Viewing your data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#querying-selecting-slicing-extracting-dataframe">Querying (selecting, slicing, extracting) Dataframe</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#select-by-column">Select by column</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#select-by-row">Select by row</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#conditional-selection">Conditional selection</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#geopandas-for-spatial-data">GeoPandas for Spatial Data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-spatial-data">Loading spatial data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#saving-spatial-data">Saving spatial data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#retrieving-data-directly-from-osm">Retrieving data directly from OSM</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#coordinate-reference-system-for-geodataframe">Coordinate Reference System for GeoDataFrame</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#computation-on-geodataframe">Computation on GeoDataFrame</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#spatial-join">Spatial join</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualization">Visualization</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Dr. Rui Zhu
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>